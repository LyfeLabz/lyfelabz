<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cell Explorer | LyfeLabz</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Fredoka+One&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #2ecc71;
    --green-dark: #27ae60;
    --blue: #3498db;
    --teal: #1abc9c;
    --purple: #9b59b6;
    --red: #e74c3c;
    --orange: #e67e22;
    --yellow: #f1c40f;
    --dark: #1a2535;
    --dark2: #243447;
    --card: #1e2f42;
    --text: #e8f4f8;
    --text-muted: #8aafca;
    --border: rgba(52,152,219,0.2);
    /* accent aliases kept for game logic */
    --bio: #2ecc71;
    --gold: #f1c40f;
    --gold-glow: rgba(241,196,15,0.35);
    --phys: #3498db;
    --neuro: #9b59b6;
    --astro: #9b59b6;
    --chem: #e67e22;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Nunito', sans-serif;
    background: var(--dark);
    color: var(--text);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
  }
  #stars { position:fixed; inset:0; pointer-events:none; z-index:0; opacity:0.55; }
  nav, .page-hero, .hud, .mode-bar, .game-section, footer { position:relative; z-index:1; }

  /* NAV */
  nav {
    position:sticky; top:0; z-index:100;
    background:rgba(20,30,45,0.97); backdrop-filter:blur(14px);
    border-bottom:1px solid var(--border);
    display:flex; align-items:center; justify-content:space-between;
    padding:0.85rem 2.5rem;
  }
  .nav-logo {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.35rem;
    font-weight: 900;
    color: var(--gold);
    text-decoration: none;
    letter-spacing: 0.06em;
    text-shadow: 0 0 18px var(--gold-glow);
  }
  .nav-links { display:flex; gap:2rem; list-style:none; flex-wrap:wrap; align-items:center; }
  .nav-links a { color:var(--muted); text-decoration:none; font-size:0.82rem; font-weight:600; letter-spacing:0.08em; text-transform:uppercase; transition:color 0.2s; }
  .nav-links a:hover { color: var(--green); }
  .nav-back {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.78rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--green);
    background: rgba(46,204,113,0.1);
    border: 1px solid rgba(46,204,113,0.4);
    padding: 0.35rem 0.9rem;
    border-radius: 99px;
  }
  .nav-badge { font-size:0.7rem; font-weight:700; letter-spacing:0.1em; text-transform:uppercase; padding:0.22rem 0.7rem; border-radius:99px; color:var(--bio); background:rgba(61,220,132,0.1); border:1px solid rgba(61,220,132,0.3); }

  /* PAGE HERO */
  .page-hero {
    padding:3.5rem 2rem 1.8rem; text-align:center;
    background:
      radial-gradient(ellipse 60% 50% at 50% 0%, rgba(61,220,132,0.07) 0%, transparent 70%),
      radial-gradient(ellipse 40% 40% at 80% 80%, rgba(41,212,245,0.05) 0%, transparent 60%);
  }
  .page-eyebrow {
    display:inline-flex; align-items:center; gap:0.5rem;
    background:rgba(61,220,132,0.1); border:1px solid rgba(61,220,132,0.3);
    color:var(--bio); padding:0.4rem 1.2rem; border-radius:99px;
    font-size:0.75rem; font-weight:700; letter-spacing:0.14em; text-transform:uppercase;
    margin-bottom:1.2rem; animation:fadeUp 0.5s ease both;
  }
  .page-hero h1 { font-family: 'Fredoka One', cursive; font-size:clamp(1.8rem,5vw,3.2rem); font-weight:900; line-height:1.1; margin-bottom:0.8rem; animation:fadeUp 0.6s 0.08s ease both; }
  .title-explorer { background:linear-gradient(135deg,var(--bio) 0%,var(--phys) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .page-hero p { color:var(--muted); font-size:0.97rem; max-width:540px; margin:0 auto; animation:fadeUp 0.6s 0.16s ease both; }

  @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

  /* HUD */
  .hud { display:flex; justify-content:center; gap:1rem; padding:1.2rem 2rem; flex-wrap:wrap; }
  .hud-item { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:0.7rem 1.4rem; text-align:center; min-width:110px; transition:border-color 0.3s, box-shadow 0.3s; }
  .hud-item.flash { border-color:var(--bio); box-shadow:0 0 16px rgba(61,220,132,0.2); }
  .hud-label { font-size:0.62rem; font-weight:700; letter-spacing:0.14em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; display:block; margin-bottom:2px; }
  .hud-value { font-family:'Orbitron',sans-serif; font-size:1.35rem; font-weight:900; color:var(--gold); display:block; transition:color 0.3s,transform 0.2s; }
  .hud-value.pop { color:var(--bio); transform:scale(1.25); }

  /* MODE TABS */
  .mode-bar { display:flex; justify-content:center; gap:0.6rem; padding:0 2rem 1rem; }
  .mode-btn { padding:0.55rem 1.6rem; background:var(--card); border:1px solid var(--border); border-radius:99px; color:var(--muted); font-family: 'Nunito', sans-serif; font-size:0.8rem; font-weight:700; cursor:pointer; letter-spacing:0.08em; text-transform:uppercase; transition:all 0.2s; }
  .mode-btn:hover { color:var(--text); border-color:rgba(255,255,255,0.2); }
  .mode-btn.active { background:rgba(61,220,132,0.12); border-color:rgba(61,220,132,0.45); color:var(--bio); }

  /* GAME LAYOUT */
  .game-section { padding:0 1.5rem 3rem; max-width:1260px; margin:0 auto; }
  .game-layout { display:flex; gap:1.5rem; align-items:flex-start; flex-wrap:wrap; }

  /* CELL */
  .cell-container { flex:1; min-width:320px; }
  .cell-frame { background:var(--card); border:1px solid var(--border); border-radius:24px; padding:12px; overflow:hidden; position:relative; }
  .cell-frame::before { content:''; position:absolute; inset:0; background:radial-gradient(ellipse 65% 60% at 50% 48%,rgba(61,220,132,0.04) 0%,transparent 70%); pointer-events:none; border-radius:24px; }
  #cellSvg { width:100%; display:block; }
  .cell-hint { text-align:center; font-size:0.72rem; color:var(--muted); margin-top:8px; letter-spacing:0.06em; font-weight:500; }
  .organelle { cursor:pointer; }

  /* INFO PANEL */
  .info-panel { width:335px; min-width:280px; display:flex; flex-direction:column; gap:1rem; }

  /* ORGANELLE CARD */
  .organelle-card { background:var(--card); border:1px solid var(--border); border-radius:20px; padding:1.5rem; min-height:210px; transition:border-color 0.3s,box-shadow 0.3s; }
  .organelle-card.active { box-shadow:0 0 24px rgba(61,220,132,0.08); }
  .card-eyebrow { font-size:0.62rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; margin-bottom:0.3rem; }
  .card-name { font-family:'Sora',sans-serif; font-size:1.15rem; font-weight:800; margin-bottom:0.2rem; }
  .card-nick { font-size:0.73rem; font-weight:600; color:var(--muted); margin-bottom:0.85rem; font-style:italic; }
  .card-desc { font-size:0.86rem; line-height:1.7; color:rgba(232,230,244,0.85); }
  .card-fact { margin-top:0.9rem; padding:0.65rem 0.9rem; background:rgba(61,220,132,0.06); border-left:3px solid rgba(61,220,132,0.5); border-radius:0 10px 10px 0; font-size:0.79rem; color:rgba(200,255,220,0.8); line-height:1.55; }
  .card-placeholder { display:flex; flex-direction:column; align-items:center; justify-content:center; height:180px; gap:0.8rem; text-align:center; color:var(--muted); font-size:0.85rem; }
  .card-placeholder .icon { font-size:2.8rem; opacity:0.6; }
  .card-placeholder strong { color:var(--text); display:block; font-size:0.9rem; margin-bottom:0.3rem; }

  /* QUIZ */
  .quiz-panel { background:var(--card); border:1px solid var(--border); border-radius:20px; padding:1.5rem; display:none; }
  .quiz-panel.show { display:block; }
  .quiz-eyebrow { font-size:0.62rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:var(--gold); font-family:'Orbitron',sans-serif; margin-bottom:0.9rem; }
  .quiz-q { font-family:'Sora',sans-serif; font-size:0.92rem; font-weight:700; color:var(--text); line-height:1.55; margin-bottom:1rem; }
  .quiz-options { display:flex; flex-direction:column; gap:0.55rem; }
  .quiz-opt { background:rgba(255,255,255,0.03); border:1px solid var(--border); border-radius:10px; padding:0.65rem 1rem; color:var(--text); font-family: 'Nunito', sans-serif; font-size:0.84rem; font-weight:500; cursor:pointer; text-align:left; transition:all 0.15s; }
  .quiz-opt:hover:not(:disabled) { background:rgba(61,220,132,0.08); border-color:rgba(61,220,132,0.35); color:var(--bio); }
  .quiz-opt.correct { background:rgba(61,220,132,0.12); border-color:rgba(61,220,132,0.6); color:var(--bio); font-weight:700; }
  .quiz-opt.wrong { background:rgba(255,112,67,0.1); border-color:rgba(255,112,67,0.5); color:var(--chem); }
  .quiz-feedback { margin-top:0.9rem; padding:0.7rem 1rem; border-radius:10px; font-size:0.82rem; display:none; line-height:1.5; }
  .quiz-feedback.show { display:block; }
  .quiz-feedback.correct { background:rgba(61,220,132,0.1); border:1px solid rgba(61,220,132,0.3); color:var(--bio); }
  .quiz-feedback.wrong   { background:rgba(255,112,67,0.08); border:1px solid rgba(255,112,67,0.3); color:var(--chem); }
  .next-btn { display:none; margin-top:0.9rem; width:100%; padding:0.75rem; background:linear-gradient(135deg,var(--gold),#ff9a42); border:none; border-radius:10px; color:#111; font-family: 'Nunito', sans-serif; font-weight:800; font-size:0.85rem; cursor:pointer; letter-spacing:0.06em; text-transform:uppercase; transition:all 0.2s; }
  .next-btn:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(245,200,66,0.4); }
  .next-btn.show { display:block; }

  /* PROGRESS */
  .progress-panel { background:var(--card); border:1px solid var(--border); border-radius:20px; padding:1.2rem 1.4rem; }
  .progress-label { font-size:0.62rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; margin-bottom:0.75rem; }
  .progress-bar-wrap { background:var(--ink3); border-radius:99px; height:6px; margin-bottom:0.9rem; overflow:hidden; }
  .progress-bar-fill { height:100%; background:linear-gradient(90deg,var(--bio),var(--phys)); border-radius:99px; transition:width 0.5s cubic-bezier(0.22,1,0.36,1); width:0%; }
  .org-chips { display:flex; flex-wrap:wrap; gap:0.4rem; }
  .org-chip { font-size:0.64rem; font-weight:600; padding:0.22rem 0.65rem; border-radius:99px; border:1px solid var(--border); color:var(--muted); transition:all 0.35s; letter-spacing:0.04em; white-space:nowrap; }
  .org-chip.done { border-color:rgba(61,220,132,0.5); color:var(--bio); background:rgba(61,220,132,0.08); }

  /* TOOLTIP */
  .tooltip { position:fixed; background:var(--dark2); border:1px solid rgba(61,220,132,0.4); border-radius:8px; padding:6px 12px; font-size:0.75rem; font-weight:700; color:var(--bio); pointer-events:none; z-index:200; white-space:nowrap; transform:translate(-50%,-115%); opacity:0; transition:opacity 0.12s; letter-spacing:0.05em; font-family:'Orbitron',sans-serif; }
  .tooltip.visible { opacity:1; }

  /* WIN MODAL */
  .modal { display:none; position:fixed; inset:0; background:rgba(11,14,26,0.88); z-index:300; align-items:center; justify-content:center; backdrop-filter:blur(8px); }
  .modal.show { display:flex; }
  .modal-box { background:var(--ink2); border:1px solid rgba(61,220,132,0.35); border-radius:24px; padding:3rem 2.5rem; max-width:460px; width:92%; text-align:center; box-shadow:0 0 80px rgba(61,220,132,0.12); animation:popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275); }
  @keyframes popIn { from{transform:scale(0.75);opacity:0} to{transform:scale(1);opacity:1} }
  .modal-trophy { font-size:4rem; margin-bottom:1rem; }
  .modal-box h2 { font-family:'Orbitron',sans-serif; font-size:1.6rem; font-weight:900; color:var(--gold); margin-bottom:0.5rem; text-shadow:0 0 20px var(--gold-glow); }
  .modal-box p { color:var(--muted); font-size:0.9rem; margin-bottom:1.2rem; line-height:1.65; }
  .modal-score { font-family:'Orbitron',sans-serif; font-size:2.8rem; font-weight:900; background:linear-gradient(135deg,var(--gold),#ff9a42); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .modal-grade { font-size:0.85rem; color:var(--bio); margin-top:0.3rem; margin-bottom:1.5rem; font-weight:700; }
  .restart-btn { padding:0.85rem 2.2rem; background:linear-gradient(135deg,var(--gold),#ff9a42); border:none; border-radius:12px; color:#111; font-family: 'Nunito', sans-serif; font-weight:800; font-size:0.95rem; cursor:pointer; letter-spacing:0.04em; transition:all 0.2s; box-shadow:0 4px 24px rgba(245,200,66,0.35); }
  .restart-btn:hover { transform:translateY(-2px); box-shadow:0 8px 32px rgba(245,200,66,0.5); }

  /* FOOTER */
  footer { background:var(--ink2); border-top:1px solid var(--border); padding:2rem; text-align:center; position:relative; z-index:1; }
  .footer-logo { font-family:'Orbitron',sans-serif; font-size:1rem; font-weight:900; color:var(--gold); letter-spacing:0.08em; margin-bottom:0.4rem; text-shadow:0 0 12px var(--gold-glow); }
  footer p { font-size:0.8rem; color:var(--muted); }

  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background:var(--dark); }
  ::-webkit-scrollbar-thumb { background:var(--dark2); border-radius:3px; }

  @media (max-width:740px) {
    .game-layout { flex-direction:column; }
    .info-panel { width:100%; }
    .nav-links { display: none; }
    nav { padding:0.75rem 1.2rem; }
    .game-section { padding:0 1rem 2rem; }
  }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<!-- NAV -->
<nav>
  <a href="index.html" class="nav-logo">LYFELABZ</a>
  <ul class="nav-links">
    <li><a href="index.html#subjects">Subjects</a></li>
    <li><a href="organelles.html">Cell Review</a></li>

  </ul>
  <span class="nav-back">üå± Biology</span>
</nav>

<!-- PAGE HERO -->
<div class="page-hero">
  <div class="page-eyebrow">üî¨ Biology ¬∑ Cell Organelles ¬∑ Game</div>
  <h1><span>Cell </span><span class="title-explorer">Explorer</span></h1>
  <p>Click on organelles to discover what they do ‚Äî then switch to Quiz Mode to test your knowledge!</p>
</div>

<!-- HUD -->
<div class="hud">
  <div class="hud-item" id="hudScore">
    <span class="hud-label">Score</span>
    <span class="hud-value" id="scoreVal">0</span>
  </div>
  <div class="hud-item">
    <span class="hud-label">Explored</span>
    <span class="hud-value" id="foundVal">0 / 13</span>
  </div>
  <div class="hud-item">
    <span class="hud-label">Streak üî•</span>
    <span class="hud-value" id="streakVal">0</span>
  </div>
</div>

<!-- MODE TABS -->
<div class="mode-bar">
  <button class="mode-btn active" id="btn-explore" onclick="setMode('explore')">üî¨ Explore</button>
  <button class="mode-btn" id="btn-quiz" onclick="setMode('quiz')">üß† Quiz Me</button>
</div>

<!-- GAME -->
<div class="game-section">
  <div class="game-layout">

    <!-- Cell SVG -->
    <div class="cell-container">
      <div class="cell-frame">
        <svg id="cellSvg" viewBox="0 0 660 580" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <radialGradient id="cellBg" cx="50%" cy="50%" r="50%">
              <stop offset="0%"   stop-color="#0e1f3a" stop-opacity="0.95"/>
              <stop offset="65%"  stop-color="#09152b" stop-opacity="0.98"/>
              <stop offset="100%" stop-color="#060d1c" stop-opacity="1"/>
            </radialGradient>
            <radialGradient id="nucGrad" cx="38%" cy="38%" r="65%">
              <stop offset="0%"  stop-color="#1a2f5e"/>
              <stop offset="100%" stop-color="#0c1a3a"/>
            </radialGradient>
            <radialGradient id="vacGrad" cx="40%" cy="35%" r="65%">
              <stop offset="0%"  stop-color="rgba(41,212,245,0.18)"/>
              <stop offset="100%" stop-color="rgba(41,212,245,0.04)"/>
            </radialGradient>
          </defs>

          <!-- Cell body fill + outer glow ring -->
          <ellipse cx="330" cy="290" rx="308" ry="268" fill="none" stroke="rgba(61,220,132,0.07)" stroke-width="16"/>
          <ellipse cx="330" cy="290" rx="307" ry="267" fill="url(#cellBg)"/>

          <!-- ‚îÄ‚îÄ PLASMA MEMBRANE ‚îÄ‚îÄ -->
          <ellipse cx="330" cy="290" rx="307" ry="267" fill="none"
            stroke="rgba(61,220,132,0.55)" stroke-width="4.5" stroke-dasharray="9,5"
            class="organelle" data-id="plasma-membrane"
            onmouseenter="tip(event,'Plasma Membrane')" onmouseleave="tipOff()"
            onclick="pick('plasma-membrane')"/>

          <!-- ‚îÄ‚îÄ CYTOPLASM (invisible large hit) ‚îÄ‚îÄ -->
          <ellipse cx="330" cy="300" rx="220" ry="200" fill="transparent"
            class="organelle" data-id="cytoplasm"
            onmouseenter="tip(event,'Cytoplasm')" onmouseleave="tipOff()"
            onclick="pick('cytoplasm')"/>

          <!-- ‚îÄ‚îÄ CYTOSKELETON ‚îÄ‚îÄ -->
          <g class="organelle" data-id="cytoskeleton"
            onmouseenter="tip(event,'Cytoskeleton')" onmouseleave="tipOff()"
            onclick="pick('cytoskeleton')">
            <line x1="80"  y1="210" x2="556" y2="435" stroke="rgba(41,212,245,0.17)" stroke-width="1.8" stroke-dasharray="5,9"/>
            <line x1="105" y1="440" x2="520" y2="155" stroke="rgba(41,212,245,0.13)" stroke-width="1.8" stroke-dasharray="5,9"/>
            <line x1="68"  y1="325" x2="578" y2="300" stroke="rgba(41,212,245,0.15)" stroke-width="1.5" stroke-dasharray="4,11"/>
            <line x1="328" y1="55"  x2="332" y2="505" stroke="rgba(41,212,245,0.11)" stroke-width="1.2" stroke-dasharray="4,14"/>
            <line x1="80"  y1="210" x2="556" y2="435" stroke="transparent" stroke-width="22"/>
          </g>

          <!-- ‚îÄ‚îÄ ROUGH ER ‚îÄ‚îÄ -->
          <g class="organelle" data-id="rough-er"
            onmouseenter="tip(event,'Rough ER')" onmouseleave="tipOff()"
            onclick="pick('rough-er')">
            <path d="M118,182 C136,164 159,175 154,193 C149,211 173,217 167,235 C161,253 185,259 179,277" fill="none" stroke="#9966ff" stroke-width="7.5" stroke-linecap="round" opacity="0.85"/>
            <path d="M138,182 C156,164 179,175 174,193 C169,211 193,217 187,235 C181,253 205,259 199,277" fill="none" stroke="#9966ff" stroke-width="7.5" stroke-linecap="round" opacity="0.82"/>
            <circle cx="128" cy="186" r="4.5" fill="#ff8844"/><circle cx="148" cy="186" r="4.5" fill="#ff8844"/>
            <circle cx="140" cy="202" r="4.5" fill="#ff9955"/><circle cx="160" cy="202" r="4.5" fill="#ff9955"/>
            <circle cx="136" cy="218" r="4.5" fill="#ff8844"/><circle cx="156" cy="218" r="4.5" fill="#ff8844"/>
            <circle cx="148" cy="233" r="4.5" fill="#ff9955"/><circle cx="168" cy="233" r="4.5" fill="#ff9955"/>
            <circle cx="163" cy="248" r="4.5" fill="#ff8844"/><circle cx="183" cy="248" r="4.5" fill="#ff8844"/>
            <circle cx="171" cy="263" r="4.5" fill="#ff9955"/><circle cx="191" cy="263" r="4.5" fill="#ff9955"/>
            <rect x="106" y="158" width="106" height="130" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ SMOOTH ER ‚îÄ‚îÄ -->
          <g class="organelle" data-id="smooth-er"
            onmouseenter="tip(event,'Smooth ER')" onmouseleave="tipOff()"
            onclick="pick('smooth-er')">
            <path d="M102,322 C126,303 145,320 136,339 C127,358 151,365 144,384 C137,403 160,408 153,427" fill="none" stroke="#29d4f5" stroke-width="7.5" stroke-linecap="round" opacity="0.8"/>
            <path d="M123,320 C147,301 166,318 157,337 C148,356 172,363 165,382 C158,401 181,406 174,425" fill="none" stroke="#29d4f5" stroke-width="7.5" stroke-linecap="round" opacity="0.77"/>
            <rect x="90" y="296" width="100" height="142" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ GOLGI APPARATUS ‚îÄ‚îÄ -->
          <g class="organelle" data-id="golgi"
            onmouseenter="tip(event,'Golgi Apparatus')" onmouseleave="tipOff()"
            onclick="pick('golgi')">
            <path d="M425,228 C466,218 490,237 484,252 C478,267 452,273 410,263" fill="none" stroke="#f5c842" stroke-width="6.5" stroke-linecap="round" opacity="0.93"/>
            <path d="M420,247 C461,237 485,256 479,272 C473,288 445,293 403,282" fill="none" stroke="#f5c842" stroke-width="6.5" stroke-linecap="round" opacity="0.88"/>
            <path d="M415,266 C456,256 480,275 474,292 C468,309 439,313 397,302" fill="none" stroke="#f5c842" stroke-width="6.5" stroke-linecap="round" opacity="0.83"/>
            <path d="M410,285 C451,275 476,295 470,312 C464,329 434,332 392,321" fill="none" stroke="#ffdd66" stroke-width="6" stroke-linecap="round" opacity="0.77"/>
            <!-- budding vesicles -->
            <circle cx="496" cy="251" r="9.5" fill="#f5c842" opacity="0.62"/>
            <circle cx="492" cy="270" r="7.5" fill="#f5c842" opacity="0.55"/>
            <circle cx="488" cy="289" r="8.5" fill="#f5c842" opacity="0.52"/>
            <circle cx="483" cy="307" r="6.5" fill="#ffdd66" opacity="0.48"/>
            <rect x="390" y="215" width="118" height="120" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ MITOCHONDRIA ‚îÄ‚îÄ -->
          <g class="organelle" data-id="mitochondria"
            onmouseenter="tip(event,'Mitochondria')" onmouseleave="tipOff()"
            onclick="pick('mitochondria')">
            <!-- main mito -->
            <ellipse cx="464" cy="402" rx="44" ry="23" fill="#3a0c00" stroke="#ff5500" stroke-width="2.8" opacity="0.97"/>
            <path d="M425,402 C437,385 452,382 464,394" fill="none" stroke="#ff7722" stroke-width="2.2" opacity="0.72"/>
            <path d="M464,394 C476,382 491,385 503,402" fill="none" stroke="#ff7722" stroke-width="2.2" opacity="0.72"/>
            <path d="M425,402 C437,419 452,422 464,410" fill="none" stroke="#ff5500" stroke-width="2" opacity="0.65"/>
            <path d="M464,410 C476,422 491,419 503,402" fill="none" stroke="#ff5500" stroke-width="2" opacity="0.65"/>
            <!-- small mito -->
            <ellipse cx="168" cy="445" rx="36" ry="18" fill="#3a0c00" stroke="#ff5500" stroke-width="2.3" opacity="0.88" transform="rotate(-20,168,445)"/>
            <path d="M138,438 C148,428 160,427 169,437" fill="none" stroke="#ff7722" stroke-width="1.8" opacity="0.6" transform="rotate(-20,154,433)"/>
            <rect x="130" y="422" width="84" height="48" fill="transparent"/>
            <rect x="418" y="377" width="92" height="52" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ NUCLEUS ‚îÄ‚îÄ -->
          <g class="organelle" data-id="nucleus"
            onmouseenter="tip(event,'Nucleus')" onmouseleave="tipOff()"
            onclick="pick('nucleus')">
            <ellipse cx="318" cy="278" rx="95" ry="82" fill="url(#nucGrad)" opacity="0.97"/>
            <ellipse cx="318" cy="278" rx="95" ry="82" fill="none" stroke="rgba(100,160,255,0.65)" stroke-width="3" stroke-dasharray="10,5"/>
            <!-- nuclear pores -->
            <circle cx="318" cy="197" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="272" cy="205" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="237" cy="232" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="224" cy="278" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="237" cy="324" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="272" cy="351" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="318" cy="359" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="364" cy="351" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="399" cy="324" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="412" cy="278" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="399" cy="232" r="5.5" fill="#4488ff" opacity="0.85"/>
            <circle cx="364" cy="205" r="5.5" fill="#4488ff" opacity="0.85"/>
          </g>

          <!-- ‚îÄ‚îÄ NUCLEOLUS (inside nucleus, stops propagation) ‚îÄ‚îÄ -->
          <circle cx="300" cy="268" r="29" fill="#0d2a5e" stroke="rgba(80,140,255,0.55)" stroke-width="2.5" opacity="0.96"
            class="organelle" data-id="nucleolus"
            onmouseenter="tip(event,'Nucleolus')" onmouseleave="tipOff()"
            onclick="pickStop('nucleolus',event)"/>
          <circle cx="300" cy="268" r="14" fill="#19357a" opacity="0.8" pointer-events="none"/>

          <!-- ‚îÄ‚îÄ LYSOSOMES ‚îÄ‚îÄ -->
          <g class="organelle" data-id="lysosome"
            onmouseenter="tip(event,'Lysosome')" onmouseleave="tipOff()"
            onclick="pick('lysosome')">
            <circle cx="376" cy="416" r="20"  fill="#1e0828" stroke="#cc22ff" stroke-width="2.8" opacity="0.92"/>
            <circle cx="376" cy="416" r="10"  fill="#2a0a38" opacity="0.7"/>
            <circle cx="410" cy="446" r="15"  fill="#1e0828" stroke="#cc22ff" stroke-width="2.2" opacity="0.86"/>
            <circle cx="344" cy="447" r="12.5" fill="#1e0828" stroke="#cc22ff" stroke-width="2"   opacity="0.82"/>
            <rect x="325" y="394" width="104" height="68" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ FREE RIBOSOMES ‚îÄ‚îÄ -->
          <g class="organelle" data-id="ribosome"
            onmouseenter="tip(event,'Ribosomes')" onmouseleave="tipOff()"
            onclick="pick('ribosome')">
            <circle cx="240" cy="350" r="5.5" fill="#ff8844" opacity="0.9"/>
            <circle cx="256" cy="365" r="5.5" fill="#ff9955" opacity="0.9"/>
            <circle cx="460" cy="330" r="5.5" fill="#ff8844" opacity="0.9"/>
            <circle cx="476" cy="315" r="5.5" fill="#ff9955" opacity="0.9"/>
            <circle cx="228" cy="368" r="4.5" fill="#ff8844" opacity="0.8"/>
            <circle cx="472" cy="345" r="4.5" fill="#ff9955" opacity="0.8"/>
            <circle cx="248" cy="382" r="4.5" fill="#ff8844" opacity="0.8"/>
            <rect x="218" y="338" width="56" height="58" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ VACUOLE ‚îÄ‚îÄ -->
          <g class="organelle" data-id="vacuole"
            onmouseenter="tip(event,'Vacuole')" onmouseleave="tipOff()"
            onclick="pick('vacuole')">
            <!-- main vacuole body ‚Äî large, water-like -->
            <ellipse cx="502" cy="175" rx="50" ry="42" fill="url(#vacGrad)" stroke="#29d4f5" stroke-width="2.8" opacity="0.9"/>
            <ellipse cx="502" cy="175" rx="42" ry="34" fill="rgba(41,212,245,0.04)" stroke="rgba(41,212,245,0.25)" stroke-width="1.2" opacity="0.7"/>
            <!-- water shimmer lines -->
            <path d="M480,168 C487,163 494,168 501,163 C508,158 515,163 522,168" fill="none" stroke="rgba(41,212,245,0.5)" stroke-width="1.6"/>
            <path d="M476,180 C483,175 490,180 497,175 C504,170 511,175 518,180" fill="none" stroke="rgba(41,212,245,0.35)" stroke-width="1.3"/>
            <path d="M482,192 C489,187 496,192 503,187" fill="none" stroke="rgba(41,212,245,0.25)" stroke-width="1.1"/>
            <!-- small secondary vacuole -->
            <ellipse cx="185" cy="195" rx="28" ry="22" fill="rgba(41,212,245,0.06)" stroke="#29d4f5" stroke-width="2" opacity="0.75"/>
            <path d="M170,190 C175,186 181,190 187,186 C193,182 199,186 205,190" fill="none" stroke="rgba(41,212,245,0.4)" stroke-width="1.2"/>
            <rect x="450" y="130" width="105" height="92" fill="transparent"/>
            <rect x="154" y="170" width="64" height="52" fill="transparent"/>
          </g>

          <!-- ‚îÄ‚îÄ VESICLES ‚îÄ‚îÄ -->
          <g class="organelle" data-id="vesicle"
            onmouseenter="tip(event,'Vesicles')" onmouseleave="tipOff()"
            onclick="pick('vesicle')">
            <!-- near Golgi (transport vesicle) -->
            <circle cx="528" cy="256" r="12"  fill="rgba(245,200,66,0.08)"  stroke="#f5c842"  stroke-width="2.2" opacity="0.88"/>
            <circle cx="528" cy="256" r="5.5" fill="rgba(245,200,66,0.18)"  opacity="0.6"/>
            <!-- near plasma membrane top-left (secretory vesicle) -->
            <circle cx="228" cy="118" r="13.5" fill="rgba(180,127,255,0.08)" stroke="#b47fff"  stroke-width="2.2" opacity="0.82"/>
            <circle cx="228" cy="118" r="6"   fill="rgba(180,127,255,0.16)" opacity="0.58"/>
            <!-- bottom center (endocytic vesicle) -->
            <circle cx="330" cy="492" r="11"  fill="rgba(61,220,132,0.08)"  stroke="#3ddc84"  stroke-width="2"   opacity="0.78"/>
            <circle cx="330" cy="492" r="5"   fill="rgba(61,220,132,0.16)"  opacity="0.52"/>
            <!-- left side (lysosomal vesicle) -->
            <circle cx="94"  cy="258" r="10"  fill="rgba(255,112,67,0.08)"  stroke="#ff7043"  stroke-width="1.8" opacity="0.74"/>
            <circle cx="94"  cy="258" r="4.5" fill="rgba(255,112,67,0.16)"  opacity="0.5"/>
            <!-- right lower (another transport) -->
            <circle cx="556" cy="368" r="9.5" fill="rgba(61,220,132,0.07)"  stroke="#3ddc84"  stroke-width="1.8" opacity="0.7"/>
            <!-- hit areas -->
            <circle cx="528" cy="256" r="22"  fill="transparent"/>
            <circle cx="228" cy="118" r="22"  fill="transparent"/>
            <circle cx="330" cy="492" r="20"  fill="transparent"/>
            <circle cx="94"  cy="258" r="20"  fill="transparent"/>
            <circle cx="556" cy="368" r="18"  fill="transparent"/>
          </g>

          <!-- SVG LABELS -->
          <g font-family="'Orbitron',monospace" pointer-events="none" font-weight="700">
            <text x="318" y="283" text-anchor="middle" font-size="8"   fill="rgba(100,160,255,0.55)">NUCLEUS</text>
            <text x="298" y="271" text-anchor="middle" font-size="7"   fill="rgba(80,120,255,0.45)">NUCLEOLUS</text>
            <text x="128" y="155" text-anchor="middle" font-size="7.5" fill="rgba(153,102,255,0.65)">ROUGH ER</text>
            <text x="114" y="308" text-anchor="middle" font-size="7.5" fill="rgba(41,212,245,0.65)">SMOOTH ER</text>
            <text x="448" y="214" text-anchor="middle" font-size="7.5" fill="rgba(245,200,66,0.78)">GOLGI</text>
            <text x="466" y="437" text-anchor="middle" font-size="7.5" fill="rgba(255,85,0,0.72)">MITO.</text>
            <text x="378" y="392" text-anchor="middle" font-size="7"   fill="rgba(204,34,255,0.72)">LYSOSOME</text>
            <text x="504" y="152" text-anchor="middle" font-size="7.5" fill="rgba(41,212,245,0.72)">VACUOLE</text>
            <text x="190" y="183" text-anchor="middle" font-size="6.5" fill="rgba(41,212,245,0.55)">VACUOLE</text>
            <text x="540" y="240" text-anchor="middle" font-size="7"   fill="rgba(245,200,66,0.65)">VESICLE</text>
            <text x="228" y="103" text-anchor="middle" font-size="7"   fill="rgba(180,127,255,0.62)">VESICLE</text>
          </g>
        </svg>
        <div class="cell-hint">Hover to identify ¬∑ Click to explore ¬∑ 13 organelles to find</div>
      </div>
    </div>

    <!-- INFO PANEL -->
    <div class="info-panel">

      <div class="organelle-card" id="orgCard">
        <div class="card-placeholder">
          <div class="icon">üî¨</div>
          <div>
            <strong>Click any organelle to explore it</strong>
            Discover what each structure does ‚Äî then switch to Quiz Mode to test your knowledge!
          </div>
        </div>
      </div>

      <div class="quiz-panel" id="quizPanel">
        <div class="quiz-eyebrow">‚ö° Knowledge Check</div>
        <div class="quiz-q" id="quizQ"></div>
        <div class="quiz-options" id="quizOpts"></div>
        <div class="quiz-feedback" id="quizFeedback"></div>
        <button class="next-btn" id="nextBtn" onclick="nextQ()">Next Question ‚Üí</button>
      </div>

      <div class="progress-panel">
        <div class="progress-label">Organelles Explored</div>
        <div class="progress-bar-wrap">
          <div class="progress-bar-fill" id="progressFill"></div>
        </div>
        <div class="org-chips" id="orgChips"></div>
      </div>

    </div>
  </div>
</div>

<!-- WIN MODAL -->
<div class="modal" id="winModal">
  <div class="modal-box">
    <div class="modal-trophy">üèÜ</div>
    <h2>Cell Expert!</h2>
    <p>Outstanding work, scientist! You've mastered the animal cell inside and out.</p>
    <div class="modal-score" id="modalScore">0 pts</div>
    <div class="modal-grade" id="modalGrade"></div>
    <button class="restart-btn" onclick="restart()">üîÑ Play Again</button>
  </div>
</div>

<div class="tooltip" id="tip"></div>

<footer>
  <div class="footer-logo">LYFELABZ</div>
  <p>Your middle school science hub ¬∑ lyfelabz.com ¬∑ made for curious scientists everywhere</p>
</footer>

<!-- Starfield -->
<script>
  const canvas = document.getElementById('stars');
  const ctx = canvas.getContext('2d');
  let stars = [];
  function resize() {
    canvas.width  = window.innerWidth;
    canvas.height = document.body.scrollHeight;
    stars = [];
    const n = Math.floor(canvas.width * canvas.height / 3800);
    for (let i = 0; i < n; i++) stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.4+0.2, a:Math.random()*0.65+0.1, speed:Math.random()*0.3+0.04, phase:Math.random()*Math.PI*2 });
  }
  function draw(t) {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    stars.forEach(s => { const a=s.a*(0.55+0.45*Math.sin(t*0.001*s.speed+s.phase)); ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle=`rgba(220,210,255,${a})`; ctx.fill(); });
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize', () => { clearTimeout(window._rt); window._rt=setTimeout(resize,200); });
  resize(); requestAnimationFrame(draw);
</script>

<!-- Game Logic -->
<script>
const ORGS = {
  'plasma-membrane':{name:'Plasma Membrane',nick:'"The Gatekeeper"',desc:'A flexible, selectively permeable barrier surrounding the entire cell. Made of a phospholipid bilayer studded with proteins, it controls what enters and exits ‚Äî letting nutrients in and waste products out.',fact:'üåä The plasma membrane is only ~8 nanometers thick ‚Äî yet it precisely regulates the movement of thousands of different molecules every second.',color:'rgba(61,220,132,0.45)'},
  'cytoplasm':{name:'Cytoplasm',nick:'"The Cell\'s Interior Ocean"',desc:'The jelly-like fluid (cytosol) that fills the cell and keeps all organelles suspended. Mostly water mixed with proteins, salts, and sugars. Thousands of metabolic reactions occur here every second.',fact:'üß´ The cytoplasm is about 80% water and acts as a solvent for nearly all of the chemistry of life.',color:'rgba(41,212,245,0.4)'},
  'nucleus':{name:'Nucleus',nick:'"The Command Center"',desc:'The largest organelle ‚Äî the cell\'s control tower. It houses the cell\'s DNA (chromatin) and directs all cellular activities including growth, metabolism, protein synthesis, and cell reproduction.',fact:'üß¨ Human cells pack about 6 feet (1.8 m) of DNA inside a nucleus just 6 micrometers wide!',color:'rgba(68,136,255,0.5)'},
  'nucleolus':{name:'Nucleolus',nick:'"The Ribosome Factory"',desc:'A dense region inside the nucleus that produces ribosomal RNA (rRNA) and assembles ribosome subunits. Cells with high protein-synthesis demands have large, prominent nucleoli.',fact:'üè≠ A single nucleolus can produce thousands of ribosome subunits per minute during active growth.',color:'rgba(100,150,255,0.5)'},
  'rough-er':{name:'Rough Endoplasmic Reticulum',nick:'"The Studded Protein Workshop"',desc:'A network of membrane sacs studded with ribosomes (making it look "rough"). It synthesizes, folds, and begins modifying proteins destined for secretion, the plasma membrane, or lysosomes.',fact:'‚úâÔ∏è Think of rough ER as a factory + packaging department ‚Äî proteins are built on ribosomes, then shipped toward the Golgi.',color:'rgba(153,102,255,0.5)'},
  'smooth-er':{name:'Smooth Endoplasmic Reticulum',nick:'"The Lipid & Detox Lab"',desc:'Lacks ribosomes ‚Äî hence the smooth appearance. Specializes in lipid and steroid hormone synthesis, detoxifying drugs and poisons, and regulating calcium ion storage used in muscle contraction.',fact:'üíä Liver cells are packed with smooth ER ‚Äî it\'s what breaks down alcohol and most medications in your body.',color:'rgba(41,212,245,0.5)'},
  'golgi':{name:'Golgi Apparatus',nick:'"The Cell\'s Post Office"',desc:'Receives proteins from the rough ER, modifies them (adding sugar tags, cutting chains), sorts them by destination, and packages them into vesicles for delivery inside or outside the cell.',fact:'üì¨ Named after Camillo Golgi (1843‚Äì1926), who discovered it using a silver staining technique ‚Äî earning him the 1906 Nobel Prize!',color:'rgba(245,200,66,0.5)'},
  'mitochondria':{name:'Mitochondria',nick:'"Powerhouse of the Cell"',desc:'Energy-producing organelles that generate ATP through cellular respiration, using oxygen and glucose. They have their own DNA and a double membrane ‚Äî evidence they were once free-living bacteria.',fact:'‚ö° A single heart muscle cell may contain over 5,000 mitochondria to power a lifetime of beating!',color:'rgba(255,85,0,0.5)'},
  'lysosome':{name:'Lysosome',nick:'"The Recycling & Cleanup Crew"',desc:'Membrane-bound sacs containing powerful digestive enzymes. They break down worn-out organelles, cellular debris, and invading pathogens. Their interior is kept acidic (pH ~4.5) to activate the enzymes.',fact:'üóëÔ∏è The process of a cell digesting its own components is called autophagy ‚Äî it earned Yoshinori Ohsumi the 2016 Nobel Prize!',color:'rgba(204,34,255,0.5)'},
  'ribosome':{name:'Ribosomes',nick:'"The Protein Builders"',desc:'Tiny molecular machines that translate mRNA sequences into proteins ‚Äî the core process of gene expression. Made of two subunits of rRNA and proteins. Found free in cytoplasm or docked on the rough ER.',fact:'‚öôÔ∏è A cell can contain millions of ribosomes, each adding ~20 amino acids per second to a growing protein chain.',color:'rgba(255,136,68,0.5)'},
  'cytoskeleton':{name:'Cytoskeleton',nick:'"Scaffold & Cellular Highway"',desc:'A dynamic network of protein filaments (microfilaments, intermediate filaments, microtubules) that gives the cell its shape, enables movement, and acts as tracks for transporting organelles and vesicles.',fact:'üõ§Ô∏è Motor proteins called kinesins literally "walk" along microtubule tracks at ~100 steps/second, ferrying cargo across the cell.',color:'rgba(41,212,245,0.45)'},
  'vacuole':{name:'Vacuole',nick:'"The Storage Tank"',desc:'Membrane-bound sacs that store water, nutrients, enzymes, or waste products. In animal cells vacuoles are small and temporary ‚Äî helping with water balance, digestion, and removing unwanted materials.',fact:'üå± In plant cells, a giant central vacuole can occupy 90% of the cell\'s volume! Animal vacuoles are smaller but equally vital for storage and waste handling.',color:'rgba(41,212,245,0.5)'},
  'vesicle':{name:'Vesicles',nick:'"The Delivery Trucks"',desc:'Tiny, spherical membrane sacs that transport materials between organelles or to/from the cell surface. They bud off from the ER or Golgi, carry their cargo, then fuse with the target membrane to deliver it.',fact:'üì¶ Exocytosis ‚Äî a vesicle fusing with the plasma membrane to release contents outside ‚Äî is exactly how neurons release neurotransmitters, the chemical signals of your brain!',color:'rgba(245,200,66,0.5)'}
};

const TOTAL = Object.keys(ORGS).length;

const QUESTIONS = [
  {q:"Which organelle is called the 'powerhouse of the cell'?", a:"Mitochondria", o:["Nucleus","Mitochondria","Golgi Apparatus","Lysosome"]},
  {q:"What structure controls what enters and exits the cell?", a:"Plasma Membrane", o:["Cell Wall","Plasma Membrane","Cytoplasm","Nucleus"]},
  {q:"Where is ribosomal RNA (rRNA) produced?", a:"Nucleolus", o:["Nucleus","Rough ER","Nucleolus","Golgi Apparatus"]},
  {q:"Which organelle acts as the 'post office' of the cell?", a:"Golgi Apparatus", o:["Rough ER","Smooth ER","Golgi Apparatus","Lysosome"]},
  {q:"The Rough ER appears bumpy because it is studded with:", a:"Ribosomes", o:["Mitochondria","Ribosomes","Lysosomes","Vesicles"]},
  {q:"Which organelle digests worn-out cell parts and debris?", a:"Lysosome", o:["Smooth ER","Lysosome","Nucleolus","Cytoskeleton"]},
  {q:"Lipid synthesis and drug detoxification occur in:", a:"Smooth ER", o:["Rough ER","Golgi Apparatus","Smooth ER","Plasma Membrane"]},
  {q:"What gives the cell its shape and serves as an internal transport highway?", a:"Cytoskeleton", o:["Cytoplasm","Plasma Membrane","Cytoskeleton","Ribosome"]},
  {q:"Which organelle contains the cell's DNA?", a:"Nucleus", o:["Mitochondria","Nucleus","Nucleolus","Lysosome"]},
  {q:"Small spherical membrane sacs that transport materials between organelles are called:", a:"Vesicles", o:["Lysosomes","Vacuoles","Vesicles","Ribosomes"]},
  {q:"Which organelle stores water, nutrients, and waste in animal cells?", a:"Vacuole", o:["Lysosome","Vesicle","Vacuole","Smooth ER"]},
  {q:"How are vesicles different from vacuoles?", a:"Vesicles are smaller transport sacs; vacuoles are larger storage sacs", o:["Vesicles are larger storage sacs; vacuoles are smaller","Vesicles are smaller transport sacs; vacuoles are larger storage sacs","Both are identical structures","Vesicles contain DNA; vacuoles do not"]},
  {q:"Proteins from the Rough ER are next sent to which organelle for processing?", a:"Golgi Apparatus", o:["Lysosome","Mitochondria","Golgi Apparatus","Smooth ER"]},
  {q:"Which organelle generates ATP through cellular respiration?", a:"Mitochondria", o:["Nucleus","Ribosome","Lysosome","Mitochondria"]},
  {q:"Mitochondria have their own DNA ‚Äî suggesting they once were free-living:", a:"Bacteria", o:["Viruses","Bacteria","Plant cells","Fungi"]},
  {q:"When a vesicle fuses with the plasma membrane to release its contents outside the cell, this is called:", a:"Exocytosis", o:["Endocytosis","Exocytosis","Osmosis","Phagocytosis"]},
  {q:"Which organelle is responsible for the jelly-like fluid that fills the cell?", a:"Cytoplasm", o:["Nucleus","Cytoplasm","Vacuole","Smooth ER"]},
  {q:"The nucleolus is located inside which organelle?", a:"Nucleus", o:["Rough ER","Golgi Apparatus","Nucleus","Cytoplasm"]},
  {q:"Which process involves a cell digesting its own damaged organelles?", a:"Autophagy", o:["Endocytosis","Exocytosis","Autophagy","Mitosis"]},
  {q:"Motor proteins like kinesin travel along which component of the cytoskeleton?", a:"Microtubules", o:["Microfilaments","Microtubules","Intermediate filaments","Nuclear pores"]},
];

// STATE
let score=0, streak=0, visited=new Set(), mode='explore';
let qPool=[], qIdx=0, answered=false, quizDone=0, quizCorrect=0;

function init() { buildChips(); shuffleQ(); }

function buildChips() {
  const c = document.getElementById('orgChips');
  c.innerHTML = '';
  Object.keys(ORGS).forEach(id => {
    const ch = document.createElement('div');
    ch.className = 'org-chip' + (visited.has(id) ? ' done' : '');
    ch.id = 'chip-' + id;
    ch.textContent = ORGS[id].name.replace('Endoplasmic Reticulum','ER');
    c.appendChild(ch);
  });
}

function shuffleQ() { qPool = [...QUESTIONS].sort(()=>Math.random()-0.5); qIdx=0; }

function setMode(m) {
  mode = m;
  document.getElementById('btn-explore').classList.toggle('active', m==='explore');
  document.getElementById('btn-quiz').classList.toggle('active', m==='quiz');
  const qp = document.getElementById('quizPanel');
  if (m==='quiz') { qp.classList.add('show'); loadQ(); } else qp.classList.remove('show');
}

function pick(id) {
  if (!ORGS[id]) return;
  const d = ORGS[id];
  if (!visited.has(id)) {
    visited.add(id);
    score += 50;
    const ch = document.getElementById('chip-'+id);
    if (ch) ch.classList.add('done');
    popHUD();
  }
  const card = document.getElementById('orgCard');
  card.className = 'organelle-card active';
  card.style.borderColor = d.color;
  card.innerHTML = `<div class="card-eyebrow">Animal Cell Organelle</div>
    <div class="card-name" style="color:${d.color.replace(/[\d.]+\)$/,'1)')}">
      ${d.name}</div>
    <div class="card-nick">${d.nick}</div>
    <p class="card-desc">${d.desc}</p>
    <div class="card-fact">${d.fact}</div>`;
  updateHUD();
  if (mode==='explore' && visited.size===TOTAL) setTimeout(showWin, 700);
}

function pickStop(id,e) { e.stopPropagation(); pick(id); }

function popHUD() {
  const sv = document.getElementById('scoreVal');
  sv.classList.add('pop');
  setTimeout(()=>sv.classList.remove('pop'), 350);
  const hi = document.getElementById('hudScore');
  hi.classList.add('flash');
  setTimeout(()=>hi.classList.remove('flash'), 500);
}

function updateHUD() {
  document.getElementById('scoreVal').textContent = score;
  document.getElementById('foundVal').textContent = `${visited.size} / ${TOTAL}`;
  document.getElementById('streakVal').textContent = streak;
  document.getElementById('progressFill').style.width = `${Math.round(visited.size/TOTAL*100)}%`;
}

// TOOLTIP
function tip(e, name) {
  const t=document.getElementById('tip');
  t.textContent=name; t.style.left=e.clientX+'px'; t.style.top=e.clientY+'px';
  t.classList.add('visible');
}
function tipOff() { document.getElementById('tip').classList.remove('visible'); }
document.addEventListener('mousemove', e => {
  const t=document.getElementById('tip');
  if (t.classList.contains('visible')) { t.style.left=e.clientX+'px'; t.style.top=e.clientY+'px'; }
});

// QUIZ
function loadQ() {
  if (qIdx>=qPool.length) shuffleQ();
  const q=qPool[qIdx]; answered=false;
  document.getElementById('quizQ').textContent=q.q;
  document.getElementById('quizFeedback').className='quiz-feedback';
  document.getElementById('nextBtn').className='next-btn';
  const el=document.getElementById('quizOpts'); el.innerHTML='';
  [...q.o].sort(()=>Math.random()-0.5).forEach(opt=>{
    const b=document.createElement('button');
    b.className='quiz-opt'; b.textContent=opt;
    b.onclick=()=>answer(opt,q.a,b);
    el.appendChild(b);
  });
}

const TIPS2={
  "Mitochondria":"They have their own circular DNA ‚Äî evidence of ancient bacterial origin!",
  "Plasma Membrane":"Phospholipid bilayer ‚Äî the fluid mosaic model.",
  "Nucleolus":"Sits inside the nucleus; produces ribosome subunits.",
  "Golgi Apparatus":"Think: receive ‚Üí modify ‚Üí sort ‚Üí ship.",
  "Ribosomes":"Two subunits: large (60S) + small (40S).",
  "Lysosome":"Acidic interior (pH ~4.5) activates its digestive enzymes.",
  "Smooth ER":"No ribosomes = smooth. Lipids + detox.",
  "Cytoskeleton":"Three types: microfilaments, intermediate filaments, microtubules.",
  "Nucleus":"Nuclear pores let mRNA exit toward ribosomes.",
  "Vesicles":"Bud from ER/Golgi; carry cargo to the right address.",
  "Vacuole":"Much larger in plant cells ‚Äî can take 90% of cell volume!",
  "Bacteria":"Circular DNA + double membrane = bacterial ancestry.",
  "Exocytosis":"How neurons release neurotransmitters into synapses!",
  "Autophagy":"Greek: 'self-eating.' Nobel Prize 2016!",
  "Microtubules":"Kinesin motor proteins walk along these at 100 steps/sec.",
  "Vesicles are smaller transport sacs; vacuoles are larger storage sacs":"Key distinction: vesicles move things, vacuoles store things.",
};

function answer(chosen,correct,btn) {
  if (answered) return;
  answered=true; quizDone++;
  document.querySelectorAll('.quiz-opt').forEach(b=>{ b.disabled=true; if(b.textContent===correct) b.classList.add('correct'); });
  const fb=document.getElementById('quizFeedback');
  if (chosen===correct) {
    btn.classList.add('correct'); streak++; quizCorrect++;
    const bonus=streak>=3?75:50; score+=bonus;
    fb.className='quiz-feedback correct show';
    fb.innerHTML=streak>=3
      ? `üî• ${streak} in a row! +${bonus} pts ‚Äî ${TIPS2[correct]||'Keep it up!'}`
      : `‚úÖ Correct! +${bonus} pts ‚Äî ${TIPS2[correct]||'Keep it up!'}`;
  } else {
    btn.classList.add('wrong'); streak=0;
    fb.className='quiz-feedback wrong show';
    fb.innerHTML=`‚ùå Correct answer: <strong>${correct}</strong>`;
  }
  updateHUD();
  document.getElementById('nextBtn').classList.add('show');
  if (quizDone>=10) { setTimeout(()=>{ showWin(); quizDone=0; quizCorrect=0; shuffleQ(); },700); }
}

function nextQ() { qIdx++; loadQ(); }

function showWin() {
  document.getElementById('modalScore').textContent=score+' pts';
  let grade;
  if (mode==='quiz') {
    const pct=Math.round(quizCorrect/Math.max(quizDone,1)*100);
    grade=pct>=90?`${pct}% ¬∑ A+ ‚Äî Cell Biology Master!`:pct>=75?`${pct}% ¬∑ B ‚Äî Great Work!`:pct>=60?`${pct}% ¬∑ C ‚Äî Keep Practicing!`:`${pct}% ¬∑ Keep Exploring!`;
  } else { grade='üåü All 13 Organelles Explored!'; }
  document.getElementById('modalGrade').textContent=grade;
  document.getElementById('winModal').classList.add('show');
}

function restart() {
  score=0; streak=0; visited.clear(); quizDone=0; quizCorrect=0;
  updateHUD(); buildChips(); shuffleQ();
  document.getElementById('winModal').classList.remove('show');
  const card=document.getElementById('orgCard');
  card.className='organelle-card'; card.style.borderColor='';
  card.innerHTML=`<div class="card-placeholder"><div class="icon">üî¨</div><div><strong>Click any organelle to explore it</strong>Discover what each structure does ‚Äî then switch to Quiz Mode!</div></div>`;
  document.getElementById('progressFill').style.width='0%';
  if (mode==='quiz') loadQ();
}

init();
</script>
</body>
</html>
