<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Neuron Explorer | LyfeLabz</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#0b0e1a; --ink2:#111527; --ink3:#181d35;
    --card:#141828; --card2:#1c2240; --border:rgba(180,160,255,0.12);
    --text:#e8e6f4; --muted:#7b789e; --gold:#f5c842;
    --gold-glow:rgba(245,200,66,0.35);
    --bio:#3ddc84; --phys:#29d4f5; --neuro:#b47fff; --warn:#ff7043;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Space Grotesk',sans-serif; background:var(--ink); color:var(--text); line-height:1.6; overflow-x:hidden; min-height:100vh;}
  #stars{position:fixed; inset:0; pointer-events:none; z-index:0; opacity:0.55;}
  nav,.page-hero,.hud,.mode-bar,.game-section,footer{position:relative; z-index:1;}

  nav{position:sticky; top:0; z-index:100; background:rgba(11,14,26,0.93); backdrop-filter:blur(14px);
    border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0.85rem 2.5rem;}
  .nav-logo{font-family:'Orbitron',sans-serif; font-size:1.35rem; font-weight:900; color:var(--gold); text-decoration:none; letter-spacing:0.06em; text-shadow:0 0 18px var(--gold-glow);}
  .nav-links{display:flex; gap:2rem; list-style:none; flex-wrap:wrap; align-items:center;}
  .nav-links a{color:var(--muted); text-decoration:none; font-size:0.82rem; font-weight:600; letter-spacing:0.08em; text-transform:uppercase; transition:color 0.2s;}
  .nav-links a:hover{color:var(--gold)}
  .nav-badge{font-size:0.7rem; font-weight:700; letter-spacing:0.1em; text-transform:uppercase; padding:0.22rem 0.7rem; border-radius:99px; color:var(--neuro); background:rgba(180,127,255,0.12); border:1px solid rgba(180,127,255,0.3);}

  .page-hero{padding:3.5rem 2rem 1.8rem; text-align:center;
    background:radial-gradient(ellipse 60% 50% at 50% 0%, rgba(180,127,255,0.07) 0%, transparent 70%),
             radial-gradient(ellipse 40% 40% at 80% 80%, rgba(41,212,245,0.05) 0%, transparent 60%);}
  .page-eyebrow{display:inline-flex; align-items:center; gap:0.5rem; background:rgba(180,127,255,0.12);
    border:1px solid rgba(180,127,255,0.32); color:var(--neuro); padding:0.4rem 1.2rem; border-radius:99px;
    font-size:0.75rem; font-weight:700; letter-spacing:0.14em; text-transform:uppercase; margin-bottom:1.2rem; animation:fadeUp 0.5s ease both;}
  .page-hero h1{font-family:'Orbitron',sans-serif; font-size:clamp(1.8rem,5vw,3.2rem); font-weight:900; line-height:1.1; margin-bottom:0.8rem; animation:fadeUp 0.6s 0.08s ease both;}
  .title-explorer{background:linear-gradient(135deg,var(--neuro) 0%,var(--phys) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
  .page-hero p{color:var(--muted); font-size:0.97rem; max-width:620px; margin:0 auto; animation:fadeUp 0.6s 0.16s ease both;}
  @keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

  .hud{display:flex; justify-content:center; gap:1rem; padding:1.2rem 2rem; flex-wrap:wrap;}
  .hud-item{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:0.7rem 1.4rem; text-align:center; min-width:120px; transition:border-color 0.3s, box-shadow 0.3s;}
  .hud-item.flash{border-color:var(--neuro); box-shadow:0 0 16px rgba(180,127,255,0.2);}
  .hud-label{font-size:0.62rem; font-weight:700; letter-spacing:0.14em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; display:block; margin-bottom:2px;}
  .hud-value{font-family:'Orbitron',sans-serif; font-size:1.25rem; font-weight:900; color:var(--gold); display:block; transition:color 0.3s, transform 0.2s;}
  .hud-value.pop{color:var(--neuro); transform:scale(1.2);}

  .mode-bar{display:flex; justify-content:center; gap:0.6rem; padding:0 2rem 1rem; flex-wrap:wrap;}
  .mode-btn{padding:0.55rem 1.6rem; background:var(--card); border:1px solid var(--border); border-radius:99px; color:var(--muted);
    font-size:0.8rem; font-weight:800; cursor:pointer; letter-spacing:0.08em; text-transform:uppercase; transition:all 0.2s;}
  .mode-btn:hover{color:var(--text); border-color:rgba(255,255,255,0.2)}
  .mode-btn.active{background:rgba(180,127,255,0.14); border-color:rgba(180,127,255,0.45); color:var(--neuro);}

  .game-section{padding:0 1.5rem 3rem; max-width:1260px; margin:0 auto;}
  .game-layout{display:flex; gap:1.5rem; align-items:flex-start; flex-wrap:wrap;}

  .neuron-container{flex:1; min-width:320px;}
  .neuron-frame{background:var(--card); border:1px solid var(--border); border-radius:24px; padding:12px; overflow:hidden; position:relative;}
  .neuron-frame::before{content:''; position:absolute; inset:0; background:radial-gradient(ellipse 65% 60% at 50% 48%,rgba(180,127,255,0.04) 0%,transparent 70%); pointer-events:none; border-radius:24px;}
  #neuronSvg{width:100%; display:block;}
  .neuron-hint{text-align:center; font-size:0.72rem; color:var(--muted); margin-top:8px; letter-spacing:0.06em; font-weight:500;}
  .hot{cursor:pointer;}

  .info-panel{width:355px; min-width:280px; display:flex; flex-direction:column; gap:1rem;}
  .card{background:var(--card); border:1px solid var(--border); border-radius:20px; padding:1.5rem; min-height:210px; transition:border-color 0.3s, box-shadow 0.3s;}
  .card.active{box-shadow:0 0 24px rgba(180,127,255,0.10);}
  .card-eyebrow{font-size:0.62rem; font-weight:700; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; margin-bottom:0.3rem;}
  .card-name{font-family:'Sora',sans-serif; font-size:1.15rem; font-weight:800; margin-bottom:0.2rem;}
  .card-nick{font-size:0.73rem; font-weight:600; color:var(--muted); margin-bottom:0.85rem; font-style:italic;}
  .card-desc{font-size:0.86rem; line-height:1.7; color:rgba(232,230,244,0.85);}
  .card-fact{margin-top:0.9rem; padding:0.65rem 0.9rem; background:rgba(180,127,255,0.07); border-left:3px solid rgba(180,127,255,0.55); border-radius:0 10px 10px 0; font-size:0.79rem; color:rgba(225,210,255,0.85); line-height:1.55;}
  .placeholder{display:flex; flex-direction:column; align-items:center; justify-content:center; height:180px; gap:0.8rem; text-align:center; color:var(--muted); font-size:0.85rem;}
  .placeholder .icon{font-size:2.8rem; opacity:0.6;}
  .placeholder strong{color:var(--text); display:block; font-size:0.9rem; margin-bottom:0.3rem;}

  .panel{background:var(--card); border:1px solid var(--border); border-radius:20px; padding:1.2rem 1.4rem;}
  .panel-title{font-size:0.62rem; font-weight:800; letter-spacing:0.16em; text-transform:uppercase; color:var(--muted); font-family:'Orbitron',sans-serif; margin-bottom:0.75rem;}

  .progress-bar-wrap{background:var(--ink3); border-radius:99px; height:6px; margin-bottom:0.9rem; overflow:hidden;}
  .progress-bar-fill{height:100%; background:linear-gradient(90deg,var(--neuro),var(--phys)); border-radius:99px; transition:width 0.5s cubic-bezier(0.22,1,0.36,1); width:0%;}
  .chips{display:flex; flex-wrap:wrap; gap:0.4rem;}
  .chip{font-size:0.64rem; font-weight:700; padding:0.22rem 0.65rem; border-radius:99px; border:1px solid var(--border); color:var(--muted); transition:all 0.35s; letter-spacing:0.04em; white-space:nowrap;}
  .chip.done{border-color:rgba(180,127,255,0.55); color:var(--neuro); background:rgba(180,127,255,0.10);}

  .signal-panel{display:none;}
  .signal-panel.show{display:block;}
  .signal-row{display:flex; gap:0.6rem; flex-wrap:wrap; margin-top:0.7rem;}
  .btn{flex:1; padding:0.7rem 0.9rem; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,0.03);
    color:var(--text); font-weight:800; cursor:pointer; letter-spacing:0.04em; transition:transform 0.15s, border-color 0.2s, background 0.2s; min-width:140px;}
  .btn:hover{transform:translateY(-1px); border-color:rgba(255,255,255,0.18);}
  .btn.primary{background:linear-gradient(135deg,var(--gold),#ff9a42); color:#111; border:none;}
  .toggle{display:flex; align-items:center; justify-content:space-between; gap:0.75rem; padding:0.7rem 0.9rem; border:1px solid var(--border); border-radius:12px; background:rgba(255,255,255,0.03); color:var(--text); font-weight:800;}
  .toggle small{color:var(--muted); font-weight:700; letter-spacing:0.02em;}
  .switch{width:44px; height:24px; border-radius:999px; background:rgba(255,255,255,0.12); border:1px solid var(--border); position:relative; cursor:pointer; flex:0 0 auto;}
  .knob{position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:var(--muted); transition:left 0.2s, background 0.2s;}
  .switch.on{background:rgba(180,127,255,0.22); border-color:rgba(180,127,255,0.45);}
  .switch.on .knob{left:22px; background:var(--neuro);}

  .quiz-panel{display:none;}
  .quiz-panel.show{display:block;}
  .quiz-eyebrow{font-size:0.62rem; font-weight:900; letter-spacing:0.16em; text-transform:uppercase; color:var(--gold); font-family:'Orbitron',sans-serif; margin-bottom:0.9rem;}
  .quiz-q{font-family:'Sora',sans-serif; font-size:0.92rem; font-weight:800; color:var(--text); line-height:1.55; margin-bottom:1rem;}
  .quiz-options{display:flex; flex-direction:column; gap:0.55rem;}
  .quiz-opt{background:rgba(255,255,255,0.03); border:1px solid var(--border); border-radius:10px; padding:0.65rem 1rem;
    color:var(--text); font-size:0.84rem; font-weight:700; cursor:pointer; text-align:left; transition:all 0.15s;}
  .quiz-opt:hover:not(:disabled){background:rgba(180,127,255,0.10); border-color:rgba(180,127,255,0.35); color:var(--neuro);}
  .quiz-opt.correct{background:rgba(61,220,132,0.12); border-color:rgba(61,220,132,0.6); color:var(--bio); font-weight:900;}
  .quiz-opt.wrong{background:rgba(255,112,67,0.10); border-color:rgba(255,112,67,0.55); color:var(--warn);}
  .quiz-feedback{margin-top:0.9rem; padding:0.7rem 1rem; border-radius:10px; font-size:0.82rem; display:none; line-height:1.5;}
  .quiz-feedback.show{display:block;}
  .quiz-feedback.correct{background:rgba(61,220,132,0.10); border:1px solid rgba(61,220,132,0.3); color:var(--bio);}
  .quiz-feedback.wrong{background:rgba(255,112,67,0.08); border:1px solid rgba(255,112,67,0.3); color:var(--warn);}
  .next-btn{display:none; margin-top:0.9rem; width:100%; padding:0.75rem; background:linear-gradient(135deg,var(--gold),#ff9a42);
    border:none; border-radius:10px; color:#111; font-weight:900; font-size:0.85rem; cursor:pointer; letter-spacing:0.06em; text-transform:uppercase; transition:all 0.2s;}
  .next-btn.show{display:block;}

  .tooltip{position:fixed; background:var(--card2); border:1px solid rgba(180,127,255,0.45); border-radius:8px; padding:6px 12px;
    font-size:0.75rem; font-weight:900; color:var(--neuro); pointer-events:none; z-index:200; white-space:nowrap;
    transform:translate(-50%,-115%); opacity:0; transition:opacity 0.12s; letter-spacing:0.05em; font-family:'Orbitron',sans-serif;}
  .tooltip.visible{opacity:1;}

  .modal{display:none; position:fixed; inset:0; background:rgba(11,14,26,0.88); z-index:300; align-items:center; justify-content:center; backdrop-filter:blur(8px);}
  .modal.show{display:flex;}
  .modal-box{background:var(--ink2); border:1px solid rgba(180,127,255,0.35); border-radius:24px; padding:3rem 2.5rem; max-width:470px; width:92%;
    text-align:center; box-shadow:0 0 80px rgba(180,127,255,0.12);}
  .modal-trophy{font-size:4rem; margin-bottom:1rem;}
  .modal-box h2{font-family:'Orbitron',sans-serif; font-size:1.6rem; font-weight:900; color:var(--gold); margin-bottom:0.5rem; text-shadow:0 0 20px var(--gold-glow);}
  .modal-box p{color:var(--muted); font-size:0.9rem; margin-bottom:1.2rem; line-height:1.65;}
  .modal-score{font-family:'Orbitron',sans-serif; font-size:2.6rem; font-weight:900; background:linear-gradient(135deg,var(--gold),#ff9a42); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
  .modal-grade{font-size:0.85rem; color:var(--neuro); margin-top:0.3rem; margin-bottom:1.5rem; font-weight:800;}
  .restart-btn{padding:0.85rem 2.2rem; background:linear-gradient(135deg,var(--gold),#ff9a42); border:none; border-radius:12px; color:#111; font-weight:900; font-size:0.95rem; cursor:pointer; letter-spacing:0.04em;}

  footer{background:var(--ink2); border-top:1px solid var(--border); padding:2rem; text-align:center;}
  .footer-logo{font-family:'Orbitron',sans-serif; font-size:1rem; font-weight:900; color:var(--gold); letter-spacing:0.08em; margin-bottom:0.4rem; text-shadow:0 0 12px var(--gold-glow);}
  footer p{font-size:0.8rem; color:var(--muted);}

  /* Action potential line ‚Äî rides above the axon */
  .ap-line{stroke:rgba(180,127,255,0.0); stroke-width:5; stroke-linecap:round; transition:opacity 0.3s;}
  .ap-line.active{
    stroke:rgba(41,212,245,1);
    stroke-width:5;
    filter:drop-shadow(0 0 8px rgba(41,212,245,0.9)) drop-shadow(0 0 20px rgba(41,212,245,0.5));
    animation:apPulse 0.4s ease-in-out infinite alternate;
  }
  @keyframes apPulse{from{stroke-opacity:0.8} to{stroke-opacity:1}}

  /* Nodes of Ranvier */
  .node{fill:rgba(180,127,255,0.45); stroke:rgba(180,127,255,0.7); stroke-width:2;}
  .node.active{
    fill:rgba(41,212,245,1);
    stroke:rgba(255,255,255,0.9); stroke-width:2;
    filter:drop-shadow(0 0 12px rgba(41,212,245,0.9));
  }

  /* Synaptic vesicles */
  .ves{fill:rgba(245,200,66,0.18); stroke:rgba(245,200,66,0.7); stroke-width:2; transition:all 0.25s;}
  .ves.active{fill:rgba(245,200,66,0.85); stroke:rgba(255,240,120,0.95); stroke-width:2.5; filter:drop-shadow(0 0 10px rgba(245,200,66,0.7));}

  /* Neurotransmitters in cleft */
  .nt{fill:rgba(61,220,132,0.0); transition:all 0.3s;}
  .nt.active{fill:rgba(61,220,132,0.95); filter:drop-shadow(0 0 8px rgba(61,220,132,0.7));}

  /* Myelin hidden state */
  .hidden{opacity:0.12; transition:opacity 0.35s;}

  @media (max-width:740px){
    .game-layout{flex-direction:column;}
    .info-panel{width:100%;}
    nav{padding:0.75rem 1.2rem;}
    .game-section{padding:0 1rem 2rem;}
  }
</style>
</head>
<body>
<canvas id="stars"></canvas>

<nav>
  <a href="index.html" class="nav-logo">LYFELABZ</a>
  <ul class="nav-links">
    <li><a href="index.html#subjects">Subjects</a></li>
    <li><a href="organelles.html">Cell Review</a></li>
    <li><span class="nav-badge">üß† Neuro Extension</span></li>
  </ul>
</nav>

<div class="page-hero">
  <div class="page-eyebrow">üß† Biology Extension ¬∑ Neuron Signaling</div>
  <h1><span>Neuron </span><span class="title-explorer">Explorer</span></h1>
  <p>Explore neuron parts first, then switch to Signal Mode to watch how an action potential travels and triggers neurotransmitter release.</p>
</div>

<div class="hud">
  <div class="hud-item" id="hudScore"><span class="hud-label">Score</span><span class="hud-value" id="scoreVal">0</span></div>
  <div class="hud-item"><span class="hud-label">Explored</span><span class="hud-value" id="foundVal">0 / 11</span></div>
  <div class="hud-item"><span class="hud-label">Signal Phase</span><span class="hud-value" id="phaseVal">REST</span></div>
</div>

<div class="mode-bar">
  <button class="mode-btn active" id="btn-explore" onclick="setMode('explore')">üî¨ Structure</button>
  <button class="mode-btn" id="btn-signal" onclick="setMode('signal')">‚ö° Signal</button>
  <button class="mode-btn" id="btn-quiz" onclick="setMode('quiz')">üß† Quiz Me</button>
</div>

<div class="game-section">
  <div class="game-layout">
    <div class="neuron-container">
      <div class="neuron-frame">
        <svg id="neuronSvg" viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" aria-label="Neuron diagram">
          <defs>
            <!-- Soma gradient ‚Äî rich blue-navy sphere feel -->
            <radialGradient id="somaGrad" cx="38%" cy="35%" r="68%">
              <stop offset="0%"   stop-color="#1e3868" stop-opacity="0.98"/>
              <stop offset="60%"  stop-color="#112050" stop-opacity="0.99"/>
              <stop offset="100%" stop-color="#080f28" stop-opacity="1"/>
            </radialGradient>
            <!-- Nucleus gradient -->
            <radialGradient id="nucGrad" cx="35%" cy="35%" r="65%">
              <stop offset="0%"   stop-color="#1a3470"/>
              <stop offset="100%" stop-color="#0a1840"/>
            </radialGradient>
            <!-- Axon gradient: neuro purple ‚Üí cyan at terminal -->
            <linearGradient id="axonGrad" x1="0" x2="1" y1="0" y2="0">
              <stop offset="0%"   stop-color="rgba(180,127,255,0.75)"/>
              <stop offset="60%"  stop-color="rgba(130,110,255,0.65)"/>
              <stop offset="100%" stop-color="rgba(41,212,245,0.55)"/>
            </linearGradient>
            <!-- Myelin segment gradient ‚Äî creamy wrap look -->
            <linearGradient id="myelinGrad1" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%"   stop-color="rgba(210,185,255,0.22)"/>
              <stop offset="50%"  stop-color="rgba(180,127,255,0.14)"/>
              <stop offset="100%" stop-color="rgba(130,90,200,0.22)"/>
            </linearGradient>
            <!-- Axon terminal gradient -->
            <radialGradient id="termGrad" cx="40%" cy="35%" r="65%">
              <stop offset="0%"   stop-color="rgba(245,200,66,0.22)"/>
              <stop offset="100%" stop-color="rgba(180,130,0,0.06)"/>
            </radialGradient>
            <!-- Soft glow filter -->
            <filter id="glow-purple" x="-30%" y="-30%" width="160%" height="160%">
              <feGaussianBlur stdDeviation="4" result="b"/>
              <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="glow-cyan" x="-30%" y="-30%" width="160%" height="160%">
              <feGaussianBlur stdDeviation="5" result="b"/>
              <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- DENDRITES ‚Äî branching tree with spines      -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="dendrites"
             onmouseenter="tip(event,'Dendrites')" onmouseleave="tipOff()" onclick="pick('dendrites')">

            <!-- Primary dendrite 1 ‚Äî upper left branch -->
            <path d="M175,218 C145,192 120,172 82,148" fill="none" stroke="rgba(180,127,255,0.65)" stroke-width="9" stroke-linecap="round"/>
            <!-- Secondary branches off dendrite 1 -->
            <path d="M140,188 C125,168 108,158 88,148" fill="none" stroke="rgba(180,127,255,0.48)" stroke-width="5.5" stroke-linecap="round"/>
            <path d="M118,172 C106,155 98,142 94,125"  fill="none" stroke="rgba(180,127,255,0.38)" stroke-width="4"   stroke-linecap="round"/>
            <path d="M82,148  C68,138  55,128  42,118"  fill="none" stroke="rgba(180,127,255,0.38)" stroke-width="4"   stroke-linecap="round"/>
            <path d="M82,148  C75,162  68,170  58,178"  fill="none" stroke="rgba(180,127,255,0.32)" stroke-width="3.5" stroke-linecap="round"/>

            <!-- Primary dendrite 2 ‚Äî middle left -->
            <path d="M162,258 C128,255 100,260 60,270" fill="none" stroke="rgba(180,127,255,0.60)" stroke-width="8.5" stroke-linecap="round"/>
            <path d="M112,258 C98,240 84,228 62,220"   fill="none" stroke="rgba(180,127,255,0.42)" stroke-width="5"   stroke-linecap="round"/>
            <path d="M60,270  C46,258 35,250 22,248"   fill="none" stroke="rgba(180,127,255,0.36)" stroke-width="4"   stroke-linecap="round"/>
            <path d="M60,270  C48,282 38,292 24,298"   fill="none" stroke="rgba(180,127,255,0.32)" stroke-width="3.5" stroke-linecap="round"/>

            <!-- Primary dendrite 3 ‚Äî lower left branch -->
            <path d="M180,310 C148,345 118,372 72,398"  fill="none" stroke="rgba(180,127,255,0.58)" stroke-width="8"   stroke-linecap="round"/>
            <path d="M148,345 C134,365 118,378 98,382"  fill="none" stroke="rgba(180,127,255,0.42)" stroke-width="5"   stroke-linecap="round"/>
            <path d="M72,398  C56,388 42,378 28,372"    fill="none" stroke="rgba(180,127,255,0.35)" stroke-width="4"   stroke-linecap="round"/>
            <path d="M72,398  C60,412 50,428 38,438"    fill="none" stroke="rgba(180,127,255,0.30)" stroke-width="3.5" stroke-linecap="round"/>

            <!-- Primary dendrite 4 ‚Äî upper-most -->
            <path d="M200,188 C175,152 155,128 118,98"  fill="none" stroke="rgba(180,127,255,0.52)" stroke-width="7.5" stroke-linecap="round"/>
            <path d="M155,128 C140,112 128,100 114,88"  fill="none" stroke="rgba(180,127,255,0.38)" stroke-width="4.5" stroke-linecap="round"/>
            <path d="M155,128 C162,112 165,98 168,82"   fill="none" stroke="rgba(180,127,255,0.32)" stroke-width="3.5" stroke-linecap="round"/>
            <path d="M118,98  C104,85  90,76  75,68"    fill="none" stroke="rgba(180,127,255,0.30)" stroke-width="3"   stroke-linecap="round"/>

            <!-- Primary dendrite 5 ‚Äî lower-most -->
            <path d="M195,330 C168,372 140,405 98,438"  fill="none" stroke="rgba(180,127,255,0.48)" stroke-width="7"   stroke-linecap="round"/>
            <path d="M155,388 C138,402 122,412 104,418" fill="none" stroke="rgba(180,127,255,0.36)" stroke-width="4"   stroke-linecap="round"/>
            <path d="M98,438  C82,448  68,455  52,458"  fill="none" stroke="rgba(180,127,255,0.30)" stroke-width="3.5" stroke-linecap="round"/>
            <path d="M98,438  C90,452  82,464  72,472"  fill="none" stroke="rgba(180,127,255,0.26)" stroke-width="3"   stroke-linecap="round"/>

            <!-- Dendritic spines (tiny bump pairs along branches) -->
            <circle cx="130" cy="183" r="4.5" fill="rgba(200,160,255,0.55)"/>
            <circle cx="105" cy="258" r="4"   fill="rgba(200,160,255,0.50)"/>
            <circle cx="140" cy="350" r="4"   fill="rgba(200,160,255,0.50)"/>
            <circle cx="170" cy="142" r="3.5" fill="rgba(200,160,255,0.45)"/>
            <circle cx="158" cy="370" r="3.5" fill="rgba(200,160,255,0.45)"/>
            <circle cx="88"  cy="160" r="3"   fill="rgba(200,160,255,0.40)"/>
            <circle cx="72"  cy="275" r="3"   fill="rgba(200,160,255,0.40)"/>

            <!-- Wide transparent hit area -->
            <rect x="0" y="55" width="230" height="430" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- SOMA (Cell Body) ‚Äî rich layered sphere      -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="soma"
             onmouseenter="tip(event,'Soma (Cell Body)')" onmouseleave="tipOff()" onclick="pick('soma')">
            <!-- outer glow halo -->
            <ellipse cx="258" cy="260" rx="122" ry="106" fill="rgba(100,140,255,0.06)" stroke="none"/>
            <!-- main soma body -->
            <ellipse cx="258" cy="260" rx="114" ry="98" fill="url(#somaGrad)" stroke="rgba(120,170,255,0.55)" stroke-width="2.8" opacity="0.98"/>
            <!-- inner highlight crescent -->
            <path d="M210,195 C228,185 255,183 275,192" fill="none" stroke="rgba(180,210,255,0.18)" stroke-width="8" stroke-linecap="round"/>
            <!-- rough ER wisps inside soma -->
            <path d="M290,285 C300,278 310,282 315,292" fill="none" stroke="rgba(120,100,200,0.25)" stroke-width="3.5" stroke-linecap="round"/>
            <path d="M285,300 C295,292 308,295 314,306" fill="none" stroke="rgba(120,100,200,0.20)" stroke-width="3"   stroke-linecap="round"/>
            <path d="M278,318 C290,310 304,313 310,324" fill="none" stroke="rgba(120,100,200,0.16)" stroke-width="2.5" stroke-linecap="round"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- NUCLEUS ‚Äî with nucleolus visible inside     -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="nucleus"
             onmouseenter="tip(event,'Nucleus')" onmouseleave="tipOff()" onclick="pickStop('nucleus',event)">
            <!-- nucleus body -->
            <circle cx="240" cy="248" r="44" fill="url(#nucGrad)" stroke="rgba(80,140,255,0.60)" stroke-width="2.8" stroke-dasharray="8,4"/>
            <!-- nuclear pore dots -->
            <circle cx="240" cy="205" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="274" cy="215" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="282" cy="248" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="274" cy="281" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="240" cy="291" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="206" cy="281" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="198" cy="248" r="4" fill="rgba(80,140,255,0.65)"/>
            <circle cx="206" cy="215" r="4" fill="rgba(80,140,255,0.65)"/>
            <!-- nucleolus -->
            <circle cx="228" cy="240" r="18" fill="rgba(20,45,100,0.90)" stroke="rgba(80,120,220,0.45)" stroke-width="1.8"/>
            <circle cx="224" cy="237" r="8"  fill="rgba(35,65,130,0.80)"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- NA/K PUMP ‚Äî visible protein channel         -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="nakpump"
             onmouseenter="tip(event,'Sodium-Potassium Pump')" onmouseleave="tipOff()" onclick="pick('nakpump')">
            <!-- protein channel shape -->
            <path d="M295,188 C285,198 282,210 285,228 C282,245 285,258 295,268" fill="none" stroke="rgba(41,212,245,0.75)" stroke-width="7" stroke-linecap="round"/>
            <path d="M318,188 C328,198 331,210 328,228 C331,245 328,258 318,268" fill="none" stroke="rgba(41,212,245,0.75)" stroke-width="7" stroke-linecap="round"/>
            <!-- channel pore highlight -->
            <line x1="307" y1="200" x2="307" y2="256" stroke="rgba(41,212,245,0.30)" stroke-width="6"/>
            <!-- ion labels -->
            <circle cx="298" cy="182" r="8" fill="rgba(41,212,245,0.15)" stroke="rgba(41,212,245,0.7)" stroke-width="1.5"/>
            <text x="298" y="186" text-anchor="middle" font-size="7" fill="rgba(41,212,245,0.95)" font-weight="800" font-family="'Space Grotesk',sans-serif">Na</text>
            <circle cx="316" cy="274" r="8" fill="rgba(61,220,132,0.15)" stroke="rgba(61,220,132,0.7)" stroke-width="1.5"/>
            <text x="316" y="278" text-anchor="middle" font-size="7" fill="rgba(61,220,132,0.95)" font-weight="800" font-family="'Space Grotesk',sans-serif">K</text>
            <!-- up/down arrows -->
            <path d="M306,196 L310,190 L314,196" fill="none" stroke="rgba(41,212,245,0.65)" stroke-width="1.8"/>
            <path d="M306,260 L310,266 L314,260" fill="none" stroke="rgba(61,220,132,0.65)" stroke-width="1.8"/>
            <rect x="280" y="174" width="54" height="108" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- AXON HILLOCK ‚Äî tapered cone from soma       -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="axon-hillock"
             onmouseenter="tip(event,'Axon Hillock')" onmouseleave="tipOff()" onclick="pick('axon-hillock')">
            <!-- symmetric tapered cone, centerline at y=265 -->
            <path d="M348,240 C372,232 406,238 420,257 L420,273 C406,292 372,298 348,290 Z"
                  fill="rgba(180,127,255,0.18)" stroke="rgba(180,127,255,0.6)" stroke-width="2.5"/>
            <!-- voltage channel dots on hillock membrane, symmetric around y=265 -->
            <circle cx="360" cy="249" r="3.5" fill="rgba(41,212,245,0.55)"/>
            <circle cx="376" cy="244" r="3.5" fill="rgba(41,212,245,0.55)"/>
            <circle cx="393" cy="242" r="3.5" fill="rgba(41,212,245,0.55)"/>
            <circle cx="360" cy="281" r="3.5" fill="rgba(41,212,245,0.55)"/>
            <circle cx="376" cy="286" r="3.5" fill="rgba(41,212,245,0.55)"/>
            <circle cx="393" cy="288" r="3.5" fill="rgba(41,212,245,0.55)"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- AXON ‚Äî single clean tube, center y=265      -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="axon"
             onmouseenter="tip(event,'Axon')" onmouseleave="tipOff()" onclick="pick('axon')">
            <!-- axon tube: top edge y=251, bottom edge y=279, center y=265 -->
            <rect x="420" y="251" width="312" height="28" rx="0"
                  fill="url(#axonGrad)" opacity="0.88"/>
            <!-- axon core center line (transport tracks) -->
            <line x1="422" y1="265" x2="730" y2="265" stroke="rgba(180,127,255,0.22)" stroke-width="6"/>
            <!-- microtubule dashes -->
            <line x1="435" y1="265" x2="728" y2="265" stroke="rgba(220,200,255,0.13)" stroke-width="3" stroke-dasharray="18,12"/>
            <!-- wide transparent hit zone -->
            <rect x="420" y="245" width="312" height="40" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- MYELIN SHEATH ‚Äî realistic wrapped segments  -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g id="myelinGroup" class="hot" data-id="myelin"
             onmouseenter="tip(event,'Myelin Sheath')" onmouseleave="tipOff()" onclick="pick('myelin')">

            <!-- Segment 1: 458‚Äì535 -->
            <ellipse cx="496" cy="265" rx="38" ry="28" fill="url(#myelinGrad1)" stroke="rgba(200,175,255,0.40)" stroke-width="2"/>
            <ellipse cx="496" cy="265" rx="38" ry="22" fill="none" stroke="rgba(180,127,255,0.22)" stroke-width="1.2"/>
            <ellipse cx="496" cy="265" rx="38" ry="16" fill="none" stroke="rgba(180,127,255,0.16)" stroke-width="1"/>
            <!-- wrapping lines suggestion -->
            <path d="M460,252 C470,248 484,248 496,250 C508,248 522,248 532,252" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>
            <path d="M460,278 C470,282 484,282 496,280 C508,282 522,282 532,278" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>

            <!-- Segment 2: 548‚Äì625 -->
            <ellipse cx="586" cy="265" rx="38" ry="28" fill="url(#myelinGrad1)" stroke="rgba(200,175,255,0.40)" stroke-width="2"/>
            <ellipse cx="586" cy="265" rx="38" ry="22" fill="none" stroke="rgba(180,127,255,0.22)" stroke-width="1.2"/>
            <ellipse cx="586" cy="265" rx="38" ry="16" fill="none" stroke="rgba(180,127,255,0.16)" stroke-width="1"/>
            <path d="M550,252 C560,248 574,248 586,250 C598,248 612,248 622,252" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>
            <path d="M550,278 C560,282 574,282 586,280 C598,282 612,282 622,278" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>

            <!-- Segment 3: 638‚Äì715 -->
            <ellipse cx="676" cy="265" rx="38" ry="28" fill="url(#myelinGrad1)" stroke="rgba(200,175,255,0.40)" stroke-width="2"/>
            <ellipse cx="676" cy="265" rx="38" ry="22" fill="none" stroke="rgba(180,127,255,0.22)" stroke-width="1.2"/>
            <ellipse cx="676" cy="265" rx="38" ry="16" fill="none" stroke="rgba(180,127,255,0.16)" stroke-width="1"/>
            <path d="M640,252 C650,248 664,248 676,250 C688,248 702,248 712,252" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>
            <path d="M640,278 C650,282 664,282 676,280 C688,282 702,282 712,278" fill="none" stroke="rgba(200,175,255,0.18)" stroke-width="1.5"/>

            <!-- Schwann cell nucleus label nubs -->
            <ellipse cx="496" cy="240" rx="10" ry="6" fill="rgba(180,127,255,0.18)" stroke="rgba(180,127,255,0.35)" stroke-width="1.2"/>
            <ellipse cx="586" cy="240" rx="10" ry="6" fill="rgba(180,127,255,0.18)" stroke="rgba(180,127,255,0.35)" stroke-width="1.2"/>
            <ellipse cx="676" cy="240" rx="10" ry="6" fill="rgba(180,127,255,0.18)" stroke="rgba(180,127,255,0.35)" stroke-width="1.2"/>

            <rect x="455" y="234" width="268" height="62" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- NODES OF RANVIER ‚Äî exposed axon gaps        -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="nodes"
             onmouseenter="tip(event,'Nodes of Ranvier')" onmouseleave="tipOff()" onclick="pick('nodes')">
            <!-- pinch rings at each node -->
            <ellipse cx="536" cy="265" rx="7" ry="16" fill="rgba(14,20,50,0.92)" stroke="rgba(180,127,255,0.35)" stroke-width="1.5"/>
            <ellipse cx="626" cy="265" rx="7" ry="16" fill="rgba(14,20,50,0.92)" stroke="rgba(180,127,255,0.35)" stroke-width="1.5"/>
            <ellipse cx="716" cy="265" rx="7" ry="16" fill="rgba(14,20,50,0.92)" stroke="rgba(180,127,255,0.35)" stroke-width="1.5"/>
            <!-- Node glow circles (for animation) -->
            <circle class="node" id="node1" cx="536" cy="265" r="9"/>
            <circle class="node" id="node2" cx="626" cy="265" r="9"/>
            <circle class="node" id="node3" cx="716" cy="265" r="9"/>
            <rect x="518" y="240" width="215" height="52" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- AXON TERMINAL ‚Äî bulbous bouton              -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="axon-terminal"
             onmouseenter="tip(event,'Axon Terminal')" onmouseleave="tipOff()" onclick="pick('axon-terminal')">
            <!-- neck connecting axon tube to bouton, flush with tube top/bottom -->
            <path d="M730,251 C742,248 754,248 764,252" fill="none" stroke="rgba(245,200,66,0.45)" stroke-width="10" stroke-linecap="round"/>
            <path d="M730,279 C742,282 754,282 764,278" fill="none" stroke="rgba(245,200,66,0.45)" stroke-width="10" stroke-linecap="round"/>
            <!-- main bouton bulb, centered at y=265 -->
            <ellipse cx="792" cy="265" rx="38" ry="34" fill="url(#termGrad)" stroke="rgba(245,200,66,0.65)" stroke-width="2.8" opacity="0.95"/>
            <!-- inner membrane highlight -->
            <path d="M764,244 C774,238 790,236 802,242" fill="none" stroke="rgba(255,230,100,0.20)" stroke-width="5" stroke-linecap="round"/>
            <rect x="726" y="238" width="106" height="54" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- SYNAPTIC VESICLES ‚Äî clustered pods          -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="vesicles"
             onmouseenter="tip(event,'Synaptic Vesicles')" onmouseleave="tipOff()" onclick="pick('vesicles')">
            <circle class="ves" id="ves1" cx="785" cy="252" r="10"/>
            <circle class="ves" id="ves2" cx="802" cy="265" r="9"/>
            <circle class="ves" id="ves3" cx="782" cy="278" r="8"/>
            <!-- extra non-animated vesicles for realism -->
            <circle cx="770" cy="260" r="7" fill="rgba(245,200,66,0.14)" stroke="rgba(245,200,66,0.5)" stroke-width="1.5"/>
            <circle cx="798" cy="282" r="7" fill="rgba(245,200,66,0.14)" stroke="rgba(245,200,66,0.5)" stroke-width="1.5"/>
            <circle cx="772" cy="246" r="6" fill="rgba(245,200,66,0.12)" stroke="rgba(245,200,66,0.45)" stroke-width="1.5"/>
            <rect x="756" y="234" width="58" height="60" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- SYNAPTIC CLEFT + POST-SYNAPTIC MEMBRANE     -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g class="hot" data-id="cleft"
             onmouseenter="tip(event,'Synaptic Cleft')" onmouseleave="tipOff()" onclick="pick('cleft')">
            <!-- cleft space -->
            <rect x="832" y="230" width="22" height="70" rx="4" fill="rgba(61,220,132,0.04)" stroke="rgba(61,220,132,0.20)" stroke-width="1.5" stroke-dasharray="4,3"/>
            <!-- post-synaptic membrane (next neuron) -->
            <path d="M856,224 C864,230 866,242 864,258 C866,274 864,288 856,296"
                  fill="rgba(100,220,160,0.08)" stroke="rgba(61,220,132,0.55)" stroke-width="4" stroke-linecap="round"/>
            <!-- receptor protein bumps on post-synaptic -->
            <circle cx="859" cy="240" r="5"  fill="rgba(61,220,132,0.20)" stroke="rgba(61,220,132,0.55)" stroke-width="1.5"/>
            <circle cx="860" cy="258" r="5"  fill="rgba(61,220,132,0.20)" stroke="rgba(61,220,132,0.55)" stroke-width="1.5"/>
            <circle cx="859" cy="276" r="5"  fill="rgba(61,220,132,0.20)" stroke="rgba(61,220,132,0.55)" stroke-width="1.5"/>
            <!-- neurotransmitter dots in cleft -->
            <circle class="nt" id="nt1" cx="843" cy="247" r="5.5"/>
            <circle class="nt" id="nt2" cx="843" cy="263" r="5.5"/>
            <circle class="nt" id="nt3" cx="843" cy="279" r="5.5"/>
            <rect x="826" y="218" width="46" height="96" fill="transparent"/>
          </g>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- ACTION POTENTIAL LINE (animation overlay)   -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <path id="apLine" class="ap-line" d="M420,265 L716,265" opacity="0.0"/>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- LABELS                                      -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <g font-family="'Orbitron',monospace" font-weight="700" pointer-events="none">
            <text x="100"  y="52"  text-anchor="middle" font-size="8"   fill="rgba(180,127,255,0.60)">DENDRITES</text>
            <text x="258"  y="175" text-anchor="middle" font-size="7.5" fill="rgba(120,170,255,0.55)">SOMA</text>
            <text x="240"  y="248" text-anchor="middle" font-size="6.5" fill="rgba(80,130,220,0.50)">NUCLEUS</text>
            <text x="307"  y="172" text-anchor="middle" font-size="6.5" fill="rgba(41,212,245,0.62)">Na/K PUMP</text>
            <text x="384"  y="230" text-anchor="middle" font-size="7"   fill="rgba(180,127,255,0.65)">HILLOCK</text>
            <text x="575"  y="215" text-anchor="middle" font-size="7.5" fill="rgba(200,175,255,0.60)">MYELIN SHEATH</text>
            <text x="536"  y="300" text-anchor="middle" font-size="6.5" fill="rgba(180,127,255,0.55)">NODE</text>
            <text x="626"  y="300" text-anchor="middle" font-size="6.5" fill="rgba(180,127,255,0.55)">NODE</text>
            <text x="716"  y="300" text-anchor="middle" font-size="6.5" fill="rgba(180,127,255,0.55)">NODE</text>
            <text x="790"  y="215" text-anchor="middle" font-size="7"   fill="rgba(245,200,66,0.70)">TERMINAL</text>
            <text x="875"  y="218" text-anchor="middle" font-size="6.5" fill="rgba(61,220,132,0.65)">POST-SYN.</text>
            <text x="870"  y="228" text-anchor="middle" font-size="6"   fill="rgba(61,220,132,0.55)">MEMBRANE</text>
          </g>
        </svg>
        <div class="neuron-hint">Hover to identify ¬∑ Click to explore ¬∑ 11 parts to find ¬∑ Signal Mode animates the action potential</div>
      </div>
    </div>

    <div class="info-panel">
      <div class="card" id="infoCard">
        <div class="placeholder"><div class="icon">üß†</div><div><strong>Click a neuron part to explore it</strong>Start in Structure Mode, then switch to Signal Mode when ready.</div></div>
      </div>

      <div class="panel signal-panel" id="signalPanel">
        <div class="panel-title">Signal Mode Controls</div>
        <div class="toggle">
          <div>Myelin <small>(saltatory conduction)</small></div>
          <div class="switch on" id="myelinSwitch" onclick="toggleMyelin()"><div class="knob"></div></div>
        </div>
        <div class="signal-row">
          <button class="btn primary" onclick="runSignal()">Run Signal</button>
          <button class="btn" onclick="resetSignal()">Reset</button>
        </div>
        <div style="margin-top:0.75rem; color:var(--muted); font-size:0.82rem; line-height:1.55;">Sequence: resting ‚Üí threshold ‚Üí spike ‚Üí travel ‚Üí neurotransmitter release.</div>
      </div>

      <div class="panel quiz-panel" id="quizPanel">
        <div class="quiz-eyebrow">‚ö° Knowledge Check</div>
        <div class="quiz-q" id="quizQ"></div>
        <div class="quiz-options" id="quizOpts"></div>
        <div class="quiz-feedback" id="quizFeedback"></div>
        <button class="next-btn" id="nextBtn" onclick="nextQ()">Next Question ‚Üí</button>
      </div>

      <div class="panel">
        <div class="panel-title">Parts Explored</div>
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressFill"></div></div>
        <div class="chips" id="chips"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="winModal">
  <div class="modal-box">
    <div class="modal-trophy">üèÜ</div>
    <h2>Neuron Expert!</h2>
    <p>You explored every part. Now you can explain how structure connects to signaling.</p>
    <div class="modal-score" id="modalScore">0 pts</div>
    <div class="modal-grade" id="modalGrade"></div>
    <button class="restart-btn" onclick="restart()">üîÑ Play Again</button>
  </div>
</div>

<div class="tooltip" id="tip"></div>

<footer>
  <div class="footer-logo">LYFELABZ</div>
  <p>Your middle school science hub ¬∑ lyfelabz.com ¬∑ made with üß† for curious scientists everywhere</p>
</footer>

<script>
  // Starfield
  const canvas = document.getElementById('stars');
  const ctx = canvas.getContext('2d');
  let stars = [];
  function resizeStars(){
    canvas.width = window.innerWidth;
    canvas.height = document.body.scrollHeight;
    stars = [];
    const n = Math.floor(canvas.width * canvas.height / 3800);
    for (let i=0;i<n;i++){
      stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*1.4+0.2,a:Math.random()*0.65+0.1,speed:Math.random()*0.3+0.04,phase:Math.random()*Math.PI*2});
    }
  }
  function drawStars(t){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    stars.forEach(s=>{
      const a = s.a*(0.55+0.45*Math.sin(t*0.001*s.speed+s.phase));
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
      ctx.fillStyle=`rgba(220,210,255,${a})`; ctx.fill();
    });
    requestAnimationFrame(drawStars);
  }
  window.addEventListener('resize', ()=>{ clearTimeout(window._rt); window._rt=setTimeout(resizeStars,200); });
  resizeStars(); requestAnimationFrame(drawStars);

  // Tooltip
  function tip(e,name){
    const t=document.getElementById('tip');
    t.textContent=name; t.style.left=e.clientX+'px'; t.style.top=e.clientY+'px';
    t.classList.add('visible');
  }
  function tipOff(){ document.getElementById('tip').classList.remove('visible'); }
  document.addEventListener('mousemove', e=>{
    const t=document.getElementById('tip');
    if (t.classList.contains('visible')){ t.style.left=e.clientX+'px'; t.style.top=e.clientY+'px'; }
  });

  // Data
  const PARTS = {
    'dendrites': {name:'Dendrites', nick:'"Signal Catchers"', desc:'Branch-like structures that receive signals from other neurons. Dendrites are covered with receptor proteins and often have tiny bumps called spines that increase surface area.', fact:'üß© Many learning changes happen at dendritic spines (synaptic plasticity).', color:'rgba(180,127,255,0.75)'},
    'soma': {name:'Soma (Cell Body)', nick:'"Integrator"', desc:'The neuron‚Äôs main body. It contains organelles that keep the cell alive and it integrates incoming signals from dendrites.', fact:'üß† The soma sums signals. Some inputs excite, others inhibit.', color:'rgba(100,160,255,0.75)'},
    'nucleus': {name:'Nucleus', nick:'"Instruction Vault"', desc:'Contains DNA that controls protein production. Neurons rely on gene expression to maintain synapses and keep membranes working.', fact:'üß¨ DNA helps build receptors and ion channels.', color:'rgba(100,160,255,0.75)'},
    'axon-hillock': {name:'Axon Hillock', nick:'"Decision Point"', desc:'The trigger zone where the neuron decides whether to fire. If total input reaches threshold, voltage-gated sodium channels open and the spike begins.', fact:'‚ö° Threshold is the minimum input needed to launch the signal.', color:'rgba(180,127,255,0.75)'},
    'axon': {name:'Axon', nick:'"Signal Highway"', desc:'A long fiber that carries the action potential away from the soma. Inside the axon are transport tracks that move materials to the terminal.', fact:'üöö Axonal transport moves vesicles and proteins to the terminal.', color:'rgba(41,212,245,0.75)'},
    'myelin': {name:'Myelin Sheath', nick:'"Insulation"', desc:'Fatty covering around the axon that reduces signal loss and increases speed. It allows action potentials to jump between nodes.', fact:'üèÅ Myelin makes conduction much faster than an unmyelinated axon.', color:'rgba(180,127,255,0.75)'},
    'nodes': {name:'Nodes of Ranvier', nick:'"Jump Points"', desc:'Gaps between myelin segments where ion channels are concentrated. In myelinated axons, the action potential jumps from node to node.', fact:'‚ö° This is saltatory conduction.', color:'rgba(41,212,245,0.75)'},
    'nakpump': {name:'Sodium-Potassium Pump', nick:'"Battery Charger"', desc:'A membrane protein that uses ATP to pump 3 sodium ions out and 2 potassium ions in. This helps maintain the resting membrane potential.', fact:'üîã Resting potential helps the neuron be ready to fire quickly.', color:'rgba(41,212,245,0.75)'},
    'axon-terminal': {name:'Axon Terminal', nick:'"Signal Sender"', desc:'End of the neuron where electrical signals trigger chemical release. The terminal contains vesicles filled with neurotransmitters.', fact:'üì° Electrical becomes chemical at the synapse.', color:'rgba(245,200,66,0.85)'},
    'vesicles': {name:'Synaptic Vesicles', nick:'"Neurotransmitter Pods"', desc:'Small sacs that store neurotransmitters. When a signal arrives, vesicles fuse with the membrane and release neurotransmitters into the synaptic cleft.', fact:'üì¶ Release is exocytosis.', color:'rgba(245,200,66,0.85)'},
    'cleft': {name:'Synaptic Cleft', nick:'"Tiny Gap"', desc:'The narrow space between two neurons. Neurotransmitters diffuse across this gap and bind to receptors on the next cell.', fact:'üìè The synaptic cleft is only tens of nanometers wide.', color:'rgba(61,220,132,0.85)'}
  };
  const TOTAL = Object.keys(PARTS).length;

  // Quiz
  const QUESTIONS = [
    {q:"Where does the neuron decide whether to fire an action potential?", a:"Axon hillock", o:["Dendrites","Axon hillock","Synaptic cleft","Myelin sheath"]},
    {q:"What is the main job of dendrites?", a:"Receive signals from other neurons", o:["Send neurotransmitters","Receive signals from other neurons","Store DNA","Produce ATP"]},
    {q:"Myelin increases signal speed mainly by:", a:"Reducing leak and enabling jumps between nodes", o:["Making the axon thicker","Reducing leak and enabling jumps between nodes","Creating neurotransmitters","Replacing the axon"]},
    {q:"The gaps in myelin where signals jump are called:", a:"Nodes of Ranvier", o:["Synaptic cleft","Nodes of Ranvier","Dendritic spines","Nuclear pores"]},
    {q:"Which structure releases neurotransmitters?", a:"Axon terminal", o:["Soma","Nucleus","Axon terminal","Dendrites"]},
    {q:"Vesicles release neurotransmitters using:", a:"Exocytosis", o:["Osmosis","Diffusion","Exocytosis","Photosynthesis"]},
    {q:"The sodium-potassium pump uses ATP to:", a:"Move Na+ out and K+ in to help maintain resting potential", o:["Move K+ out and Na+ in","Move Na+ out and K+ in to help maintain resting potential","Make neurotransmitters","Open sodium channels"]},
    {q:"What is the synaptic cleft?", a:"The tiny gap between neurons", o:["A part of the nucleus","The tiny gap between neurons","A node in myelin","The inside of a vesicle"]},
    {q:"In a myelinated axon, the action potential travels by:", a:"Jumping node to node (saltatory conduction)", o:["Stopping at each myelin segment","Jumping node to node (saltatory conduction)","Only moving through dendrites","Moving backward to the soma"]},
    {q:"Which part contains the neuron's DNA?", a:"Nucleus", o:["Axon","Nucleus","Myelin sheath","Synaptic vesicle"]}
  ];

  // State
  let score = 0;
  let visited = new Set();
  let mode = 'explore';
  let myelinOn = true;

  let qPool = [];
  let qIdx = 0;
  let answered = false;
  let quizDone = 0;
  let quizCorrect = 0;

  const phaseVal = document.getElementById('phaseVal');

  function init(){
    buildChips();
    updateHUD();
    shuffleQ();
    setRestVisual();
  }

  function buildChips(){
    const c = document.getElementById('chips');
    c.innerHTML = '';
    Object.keys(PARTS).forEach(id=>{
      const ch=document.createElement('div');
      ch.className='chip' + (visited.has(id)?' done':'');
      ch.id='chip-'+id;
      ch.textContent=PARTS[id].name.replace('Sodium-Potassium','Na/K');
      c.appendChild(ch);
    });
  }

  function popHUD(){
    const sv=document.getElementById('scoreVal');
    sv.classList.add('pop');
    setTimeout(()=>sv.classList.remove('pop'),350);
    const hi=document.getElementById('hudScore');
    hi.classList.add('flash');
    setTimeout(()=>hi.classList.remove('flash'),500);
  }

  function updateHUD(){
    document.getElementById('scoreVal').textContent = score;
    document.getElementById('foundVal').textContent = `${visited.size} / ${TOTAL}`;
    document.getElementById('progressFill').style.width = `${Math.round(visited.size/TOTAL*100)}%`;
  }

  function pick(id){
    const p = PARTS[id];
    if(!p) return;

    if(!visited.has(id)){
      visited.add(id);
      score += 50;
      const ch=document.getElementById('chip-'+id);
      if(ch) ch.classList.add('done');
      popHUD();
      updateHUD();
      if(visited.size===TOTAL && mode!=='quiz'){
        setTimeout(showWin, 650);
      }
    }

    const card=document.getElementById('infoCard');
    card.className='card active';
    card.style.borderColor=p.color;
    card.innerHTML = `
      <div class="card-eyebrow">Neuron Part</div>
      <div class="card-name" style="color:${p.color}">${p.name}</div>
      <div class="card-nick">${p.nick}</div>
      <p class="card-desc">${p.desc}</p>
      <div class="card-fact">${p.fact}</div>
    `;
  }

  function pickStop(id,e){ e.stopPropagation(); pick(id); }

  function setMode(m){
    mode = m;
    document.getElementById('btn-explore').classList.toggle('active', m==='explore');
    document.getElementById('btn-signal').classList.toggle('active', m==='signal');
    document.getElementById('btn-quiz').classList.toggle('active', m==='quiz');

    const sp = document.getElementById('signalPanel');
    const qp = document.getElementById('quizPanel');

    if(m==='signal'){
      sp.classList.add('show');
      qp.classList.remove('show');
      phaseVal.textContent = 'REST';
      setRestVisual();
    } else if(m==='quiz'){
      qp.classList.add('show');
      sp.classList.remove('show');
      loadQ();
      phaseVal.textContent = 'QUIZ';
      resetSignal();
    } else {
      sp.classList.remove('show');
      qp.classList.remove('show');
      phaseVal.textContent = 'REST';
      resetSignal();
    }
  }

  // Signal visuals
  const apLine = document.getElementById('apLine');
  const nodes = [document.getElementById('node1'), document.getElementById('node2'), document.getElementById('node3')];
  const ves = [document.getElementById('ves1'), document.getElementById('ves2'), document.getElementById('ves3')];
  const nts = [document.getElementById('nt1'), document.getElementById('nt2'), document.getElementById('nt3')];
  const myelinGroup = document.getElementById('myelinGroup');

  let running = false;
  let timers = [];

  function clearTimers(){ timers.forEach(t=>clearTimeout(t)); timers=[]; }

  function setRestVisual(){
    apLine.style.opacity = "0.0";
    apLine.classList.remove('active');
    nodes.forEach(n=>n.classList.remove('active'));
    ves.forEach(v=>v.classList.remove('active'));
    nts.forEach(n=>n.classList.remove('active'));
  }

  function resetSignal(){
    running = false;
    clearTimers();
    if(mode==='signal') phaseVal.textContent = 'REST';
    setRestVisual();
  }

  function toggleMyelin(){
    myelinOn = !myelinOn;
    const sw = document.getElementById('myelinSwitch');
    sw.classList.toggle('on', myelinOn);
    myelinGroup.classList.toggle('hidden', !myelinOn);
    if(mode==='signal') resetSignal();
  }

  function runSignal(){
    if(mode!=='signal') return;
    if(running) return;
    running = true;
    resetSignal();

    phaseVal.textContent = 'THRESHOLD';
    score += 25; popHUD(); updateHUD();

    timers.push(setTimeout(()=>{
      phaseVal.textContent = 'SPIKE';
      apLine.style.opacity = "1.0";
      apLine.classList.add('active');
    }, 650));

    const travel = myelinOn ? [900, 1200, 1500] : [1050, 1500, 1950];
    travel.forEach((ms, idx)=>{
      timers.push(setTimeout(()=>{
        nodes[idx].classList.add('active');
        if(idx>0) nodes[idx-1].classList.remove('active');
      }, ms));
    });

    timers.push(setTimeout(()=>{
      phaseVal.textContent = 'RELEASE';
      nodes.forEach(n=>n.classList.remove('active'));
      ves.forEach(v=>v.classList.add('active'));
    }, myelinOn ? 1750 : 2200));

    timers.push(setTimeout(()=>{
      ves.forEach(v=>v.classList.remove('active'));
      nts.forEach(n=>n.classList.add('active'));
      score += 75; popHUD(); updateHUD();
    }, myelinOn ? 2100 : 2550));

    timers.push(setTimeout(()=>{
      phaseVal.textContent = 'REST';
      setRestVisual();
      running = false;
    }, myelinOn ? 2900 : 3400));
  }

  // Quiz logic
  function shuffleQ(){ qPool = [...QUESTIONS].sort(()=>Math.random()-0.5); qIdx=0; }
  function loadQ(){
    if(qIdx>=qPool.length) shuffleQ();
    const q=qPool[qIdx];
    answered=false;
    document.getElementById('quizQ').textContent=q.q;
    document.getElementById('quizFeedback').className='quiz-feedback';
    document.getElementById('nextBtn').className='next-btn';
    const el=document.getElementById('quizOpts'); el.innerHTML='';
    [...q.o].sort(()=>Math.random()-0.5).forEach(opt=>{
      const b=document.createElement('button');
      b.className='quiz-opt'; b.textContent=opt;
      b.onclick=()=>answer(opt,q.a,b);
      el.appendChild(b);
    });
  }

  const TIPS = {
    "Axon hillock":"Threshold is the trigger. If inputs add up enough, the spike starts.",
    "Nodes of Ranvier":"Nodes have lots of ion channels. That is why signals can jump.",
    "Exocytosis":"Vesicles fuse with the membrane and dump contents outside the cell.",
    "Nucleus":"DNA helps build and maintain channels, receptors, and synapses."
  };

  function answer(chosen, correct, btn){
    if(answered) return;
    answered=true; quizDone++;
    document.querySelectorAll('.quiz-opt').forEach(b=>{
      b.disabled=true;
      if(b.textContent===correct) b.classList.add('correct');
    });
    const fb=document.getElementById('quizFeedback');
    if(chosen===correct){
      btn.classList.add('correct');
      quizCorrect++;
      score += 75; popHUD();
      fb.className='quiz-feedback correct show';
      fb.innerHTML = `‚úÖ Correct! +75 pts<br><span style="color:rgba(200,255,220,0.85)">${TIPS[correct] || ''}</span>`;
    }else{
      btn.classList.add('wrong');
      fb.className='quiz-feedback wrong show';
      fb.innerHTML = `‚ùå Correct answer: <strong>${correct}</strong>`;
    }
    updateHUD();
    document.getElementById('nextBtn').classList.add('show');

    if(quizDone>=8){
      timers.push(setTimeout(()=>{
        showWinFromQuiz();
        quizDone=0; quizCorrect=0; shuffleQ();
      }, 650));
    }
  }

  function nextQ(){ qIdx++; loadQ(); }

  function showWin(){
    document.getElementById('modalScore').textContent = score + ' pts';
    document.getElementById('modalGrade').textContent = 'üåü All neuron parts explored!';
    document.getElementById('winModal').classList.add('show');
  }

  function showWinFromQuiz(){
    const pct = Math.round((quizCorrect / Math.max(quizDone,1))*100);
    document.getElementById('modalScore').textContent = score + ' pts';
    const grade = pct>=90 ? `${pct}% ¬∑ A+ ‚Äî Neuro Master!` : pct>=75 ? `${pct}% ¬∑ B ‚Äî Strong Work!` : pct>=60 ? `${pct}% ¬∑ C ‚Äî Keep Practicing!` : `${pct}% ¬∑ Keep Exploring!`;
    document.getElementById('modalGrade').textContent = grade;
    document.getElementById('winModal').classList.add('show');
  }

  function restart(){
    score=0; visited.clear();
    quizDone=0; quizCorrect=0;
    updateHUD(); buildChips(); shuffleQ();
    document.getElementById('winModal').classList.remove('show');
    const card=document.getElementById('infoCard');
    card.className='card'; card.style.borderColor='';
    card.innerHTML = `<div class="placeholder"><div class="icon">üß†</div><div><strong>Click a neuron part to explore it</strong>Start in Structure Mode, then switch to Signal Mode when ready.</div></div>`;
    document.getElementById('progressFill').style.width='0%';
    resetSignal();
    if(mode==='quiz') loadQ();
  }

  init();
</script>
</body>
</html>
